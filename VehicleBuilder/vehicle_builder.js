(()=>{"use strict";var e,t,s=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",i={};function o(e,t){if(!i[e]){i[e]={};for(let t=0;t<e.length;t++)i[e][e.charAt(t)]=t}return i[e][t]}var r={compressToBase64:function(e){if(null==e)return"";var s=r._compress(e,6,(function(e){return t.charAt(e)}));switch(s.length%4){default:case 0:return s;case 1:return s+"===";case 2:return s+"==";case 3:return s+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:r._decompress(e.length,32,(function(s){return o(t,e.charAt(s))}))},compressToUTF16:function(t){return null==t?"":r._compress(t,15,(function(t){return e(t+32)}))+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:r._decompress(e.length,16384,(function(t){return e.charCodeAt(t)-32}))},compressToUint8Array:function(e){var t=r.compress(e),s=new Uint8Array(2*t.length);for(let e=0,o=t.length;e<o;e++){var i=t.charCodeAt(e);s[2*e]=i>>>8,s[2*e+1]=i%256}return s},decompressFromUint8Array:function(t){if(null==t)return r.decompress(t);var s=new Array(t.length/2);for(let e=0,i=s.length;e<i;e++)s[e]=256*t[2*e]+t[2*e+1];var i=[];return s.forEach((function(t){i.push(e(t))})),r.decompress(i.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":r._compress(e,6,(function(e){return s.charAt(e)}))},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),r._decompress(e.length,32,(function(t){return o(s,e.charAt(t))})))},compress:function(t){return r._compress(t,16,(function(t){return e(t)}))},_compress:function(e,t,s){if(null==e)return"";var i,o,r,n={},a={},l="",h="",c="",u=2,d=3,m=2,p=[],g=0,f=0;for(r=0;r<e.length;r+=1)if(l=e.charAt(r),Object.prototype.hasOwnProperty.call(n,l)||(n[l]=d++,a[l]=!0),h=c+l,Object.prototype.hasOwnProperty.call(n,h))c=h;else{if(Object.prototype.hasOwnProperty.call(a,c)){if(c.charCodeAt(0)<256){for(i=0;i<m;i++)g<<=1,f==t-1?(f=0,p.push(s(g)),g=0):f++;for(o=c.charCodeAt(0),i=0;i<8;i++)g=g<<1|1&o,f==t-1?(f=0,p.push(s(g)),g=0):f++,o>>=1}else{for(o=1,i=0;i<m;i++)g=g<<1|o,f==t-1?(f=0,p.push(s(g)),g=0):f++,o=0;for(o=c.charCodeAt(0),i=0;i<16;i++)g=g<<1|1&o,f==t-1?(f=0,p.push(s(g)),g=0):f++,o>>=1}0==--u&&(u=Math.pow(2,m),m++),delete a[c]}else for(o=n[c],i=0;i<m;i++)g=g<<1|1&o,f==t-1?(f=0,p.push(s(g)),g=0):f++,o>>=1;0==--u&&(u=Math.pow(2,m),m++),n[h]=d++,c=String(l)}if(""!==c){if(Object.prototype.hasOwnProperty.call(a,c)){if(c.charCodeAt(0)<256){for(i=0;i<m;i++)g<<=1,f==t-1?(f=0,p.push(s(g)),g=0):f++;for(o=c.charCodeAt(0),i=0;i<8;i++)g=g<<1|1&o,f==t-1?(f=0,p.push(s(g)),g=0):f++,o>>=1}else{for(o=1,i=0;i<m;i++)g=g<<1|o,f==t-1?(f=0,p.push(s(g)),g=0):f++,o=0;for(o=c.charCodeAt(0),i=0;i<16;i++)g=g<<1|1&o,f==t-1?(f=0,p.push(s(g)),g=0):f++,o>>=1}0==--u&&(u=Math.pow(2,m),m++),delete a[c]}else for(o=n[c],i=0;i<m;i++)g=g<<1|1&o,f==t-1?(f=0,p.push(s(g)),g=0):f++,o>>=1;0==--u&&(u=Math.pow(2,m),m++)}for(o=2,i=0;i<m;i++)g=g<<1|1&o,f==t-1?(f=0,p.push(s(g)),g=0):f++,o>>=1;for(;;){if(g<<=1,f==t-1){p.push(s(g));break}f++}return p.join("")},decompress:function(e){return null==e?"":""==e?null:r._decompress(e.length,32768,(function(t){return e.charCodeAt(t)}))},_decompress:function(t,s,i){var o,r,n,a,l,h,c,u=[],d=4,m=4,p=3,g="",f=[],_={val:i(0),position:s,index:1};for(o=0;o<3;o+=1)u[o]=o;for(n=0,l=Math.pow(2,2),h=1;h!=l;)a=_.val&_.position,_.position>>=1,0==_.position&&(_.position=s,_.val=i(_.index++)),n|=(a>0?1:0)*h,h<<=1;switch(n){case 0:for(n=0,l=Math.pow(2,8),h=1;h!=l;)a=_.val&_.position,_.position>>=1,0==_.position&&(_.position=s,_.val=i(_.index++)),n|=(a>0?1:0)*h,h<<=1;c=e(n);break;case 1:for(n=0,l=Math.pow(2,16),h=1;h!=l;)a=_.val&_.position,_.position>>=1,0==_.position&&(_.position=s,_.val=i(_.index++)),n|=(a>0?1:0)*h,h<<=1;c=e(n);break;case 2:return""}for(u[3]=c,r=c,f.push(c);;){if(_.index>t)return"";for(n=0,l=Math.pow(2,p),h=1;h!=l;)a=_.val&_.position,_.position>>=1,0==_.position&&(_.position=s,_.val=i(_.index++)),n|=(a>0?1:0)*h,h<<=1;switch(c=n){case 0:for(n=0,l=Math.pow(2,8),h=1;h!=l;)a=_.val&_.position,_.position>>=1,0==_.position&&(_.position=s,_.val=i(_.index++)),n|=(a>0?1:0)*h,h<<=1;u[m++]=e(n),c=m-1,d--;break;case 1:for(n=0,l=Math.pow(2,16),h=1;h!=l;)a=_.val&_.position,_.position>>=1,0==_.position&&(_.position=s,_.val=i(_.index++)),n|=(a>0?1:0)*h,h<<=1;u[m++]=e(n),c=m-1,d--;break;case 2:return f.join("")}if(0==d&&(d=Math.pow(2,p),p++),u[c])g=u[c];else{if(c!==m)return null;g=r+r.charAt(0)}f.push(g),u[m++]=r+g.charAt(0),r=g,0==--d&&(d=Math.pow(2,p),p++)}}};return r}(),i=0;function o(){return"internal_id_"+(++i).toString()}function r(e){const t={div0:document.createElement("DIV"),div1:document.createElement("DIV"),div2:document.createElement("DIV")};return t.div0.classList.add("flex-container-o"),t.div1.classList.add("flex-container-i"),t.div2.classList.add("flex-container-i"),t.div0.appendChild(t.div1),t.div0.appendChild(t.div2),e&&e.appendChild(t.div0),t}function n(e,t){const s=document.createElement("TH");return s.innerHTML=t,e.appendChild(s),s}function a(e,t,s,i=!0){const r=document.createElement("SPAN"),n=document.createElement("LABEL");t.id=o(),n.htmlFor=t.id,n.style.marginLeft="0.25em",n.style.marginRight="0.5em",n.textContent=e,t.setAttribute("type","number"),t.min="0",t.step="1",t.valueAsNumber=0,r.appendChild(n),r.appendChild(t),s.appendChild(r),i&&s.appendChild(document.createElement("BR"))}function l(e,t,s){const i=document.createElement("LABEL");t.id=o(),i.htmlFor=t.id,i.style.marginLeft="0.25em",i.style.marginRight="0.5em",i.textContent=e,t.setAttribute("type","number"),t.min="0",t.step="1",t.valueAsNumber=0,i.classList.add("flex-item"),t.classList.add("flex-item"),s.div1.appendChild(i),s.div2.appendChild(t)}function h(e,t,s){const i=document.createElement("LABEL");t.id=o(),i.htmlFor=t.id,i.style.marginLeft="0.25em",i.style.marginRight="0.5em",i.textContent=e,t.setAttribute("type","text"),t.value="Default",i.classList.add("flex-item"),t.classList.add("flex-item"),s.div1.appendChild(i),s.div2.appendChild(t)}function c(e,t,s,i=!0){const r=document.createElement("SPAN"),n=document.createElement("LABEL");t.id=o(),n.htmlFor=t.id,n.style.marginLeft="0.25em",n.style.marginRight="0.5em",n.textContent=e,t.setAttribute("type","checkbox"),r.appendChild(n),r.appendChild(t),s.appendChild(r),i&&s.appendChild(document.createElement("BR"))}function u(e,t,s){const i=document.createElement("LABEL");t.id=o(),i.htmlFor=t.id,i.id=o(),i.style.marginLeft="0.25em",i.style.marginRight="0.5em",i.textContent=e,t.setAttribute("type","checkbox"),i.classList.add("flex-item"),t.classList.add("flex-item"),s.div1.appendChild(i);const r=document.createElement("LABEL"),n=document.createElement("SPAN");return n.appendChild(r),n.appendChild(t),s.div2.appendChild(n),i}function d(e){const t=document.createElement("LABEL");t.textContent=" ",t.classList.add("flex-item"),e.div1.appendChild(t);const s=document.createElement("LABEL");s.textContent=" ",s.classList.add("flex-item"),e.div2.appendChild(s)}function m(e){let t="";const s=new Uint8Array(e),i=s.byteLength;for(let e=0;e<i;e++)t+=String.fromCharCode(s[e]);return t}function p(e){const t=new Uint8Array(e.length);for(let s=0;s<e.length;s++)t[s]=e.charCodeAt(s);return t.buffer}function g(e,t){var s=document.createElement("SPAN"),i=document.createElement("LABEL");return i.textContent=e,t.id=o(),i.htmlFor=t.id,s.append(i),s.append(t),s}class f{constructor(e){this.array=new ArrayBuffer(51200),this.view=new DataView(this.array),this.offset=0}Check(){if(this.offset>=this.array.byteLength)throw"Serialization Way too long."}PushNum(e){this.view.setInt16(this.offset,e,!1),this.offset+=2,this.Check()}PushBool(e){e?this.view.setUint8(this.offset,1):this.view.setUint8(this.offset,0),this.offset+=1,this.Check()}PushString(e){this.PushNum(e.length);for(let t=0;t<e.length;t++)this.view.setUint8(this.offset,e.charCodeAt(t)),this.offset++;this.Check()}PushNumArr(e){this.PushNum(e.length);for(const t of e)this.PushNum(t);this.Check()}PushBoolArr(e){this.PushNum(e.length);for(const t of e)this.PushBool(t);this.Check()}PushFloat(e){this.view.setFloat32(this.offset,e,!1),this.offset+=4,this.Check()}FinalArray(){return this.array.slice(0,this.offset)}}class _{constructor(e){this.array=e,this.view=new DataView(this.array),this.offset=0,this.version=parseFloat(this.GetString()),this.Reset()}Reset(){this.offset=0}Check(){if(this.offset>=this.array.byteLength)throw"Deserialization Failed"}GetNum(){this.Check();const e=this.view.getInt16(this.offset,!1);return this.offset+=2,e}GetBool(){this.Check();const e=this.view.getUint8(this.offset);return this.offset+=1,e>0}GetString(){this.Check();const e=this.GetNum(),t=[];for(let s=0;s<e;s++){const e=this.view.getUint8(this.offset);t.push(e),this.offset+=1}return String.fromCharCode(...t)}GetNumArr(e){this.Check();const t=this.GetNum(),s=[];for(let e=0;e<t;e++)s.push(this.GetNum());for(;s.length<e;)s.push(0);return s}GetBoolArr(e){this.Check();const t=this.GetNum(),s=[];for(let e=0;e<t;e++)s.push(this.GetBool());for(;s.length<e;)s.push(!1);return s}GetFloat(){this.Check();const e=this.view.getFloat32(this.offset,!1);return this.offset+=4,e}CheckLastNum(){return this.view.getInt16(this.array.byteLength-2,!1)}GetRemaining(){return this.array.byteLength-this.offset}}class w{static IsNullOrWhiteSpace(e){try{return null==e||"undefined"==e||e.toString().replace(/\s/g,"").length<1}catch(e){return console.log(e),!1}}static Join(e,...t){try{const s=t[0];if(Array.isArray(s)||s instanceof Array){let t=w.Empty;for(let i=0;i<s.length;i++){const o=s[i];i<s.length-1?t+=o+e:t+=o}return t}if("object"==typeof s){let t=w.Empty;const i=s;return Object.keys(s).forEach((s=>{t+=i[s]+e})),t=t.slice(0,t.length-e.length),t}const i=t;return w.join(e,...i)}catch(e){return console.log(e),w.Empty}}static Format(e,...t){try{return e.match(w.regexNumber)?w.format(w.regexNumber,e,t):e.match(w.regexObject)?w.format(w.regexObject,e,t,!0):e}catch(e){return console.log(e),w.Empty}}static format(e,t,s,i=!1){return t.replace(e,(function(e,t){const o=e.split(":");let r;return o.length>1&&(t=o[0].replace("{",""),e=o[1].replace("}","")),r=i?s[0][t]:s[t],null==r||null==r||e.match(/{\d+}/)?r:(r=w.parsePattern(e,r),void 0!==r&&null!=r?r:w.Empty)}))}static parsePattern(e,t){switch(e){case"L":return t.toLocaleLowerCase();case"U":return t.toLocaleUpperCase();case"d":if("string"==typeof t)return w.getDisplayDateFromString(t);if(t instanceof Date)return w.Format("{0:00}.{1:00}.{2:0000}",t.getDate(),t.getMonth(),t.getFullYear());break;case"s":if("string"==typeof t)return w.getSortableDateFromString(t);if(t instanceof Date)return w.Format("{0:0000}-{1:00}-{2:00}",t.getFullYear(),t.getMonth(),t.getDate());break;case"n":{"string"!=typeof t&&(t=t.toString());const e=t.replace(/,/g,".");if(isNaN(parseFloat(e))||e.length<=3)break;const s=e.split(/[^0-9]+/g);let i=s;s.length>1&&(i=[w.join("",...s.splice(0,s.length-1)),s[s.length-1]]);const o=i[0],r=o.length%3;let n=r>0?o.substring(0,r):w.Empty;const a=o.substring(r).match(/.{3}/g);return n=n+"."+w.Join(".",a),n+(i.length>1?","+i[1]:"")}case"x":return this.decimalToHexString(t);case"X":return this.decimalToHexString(t,!0)}return"number"!=typeof t&&isNaN(t)||isNaN(+e)||w.IsNullOrWhiteSpace(t)?t:w.formatNumber(t,e)}static decimalToHexString(e,t=!1){const s=parseFloat(e).toString(16);return t?s.toLocaleUpperCase():s}static getDisplayDateFromString(e){const t=e.split("-");if(t.length<=1)return e;let s=t[t.length-1];const i=t[t.length-2],o=t[t.length-3];return s=s.split("T")[0],s=s.split(" ")[0],`${s}.${i}.${o}`}static getSortableDateFromString(e){const t=e.replace(",","").split(".");if(t.length<=1)return e;const s=t[t.length-1].split(" ");let i=w.Empty;s.length>1&&(i=s[s.length-1]);let o=`${t[t.length-1].split(" ")[0]}-${t[t.length-2]}-${t[t.length-3]}`;return!w.IsNullOrWhiteSpace(i)&&i.length>1?o+=`T${i}`:o+="T00:00:00",o}static formatNumber(e,t){const s=t.length,i=e.toString();if(s<=i.length)return i;let o=s-i.length;return o+=1,new Array(o).join("0")+i}static join(e,...t){let s=w.Empty;for(let i=0;i<t.length;i++)if(!("string"==typeof t[i]&&w.IsNullOrWhiteSpace(t[i])||"number"!=typeof t[i]&&"string"!=typeof t[i])){s+=""+t[i];for(let o=i+1;o<t.length;o++)if(!w.IsNullOrWhiteSpace(t[o])){s+=e,i=o-1;break}}return s}}w.regexNumber=/{(\d+(:\w*)?)}/g,w.regexObject=/{(\w+(:\w*)?)}/g,w.Empty="",function(e){e.None="None",e.Tiny="Tiny",e.Small="Small",e.Medium="Medium",e.Large="Large",e.Huge="Huge"}(e||(e={})),function(e){e[e.WHITE=0]="WHITE",e[e.YELLOW=1]="YELLOW",e[e.RED=2]="RED"}(t||(t={}));class b{constructor(e){this.cost=0,this.upkeep=0,this.speed=0,this.torque=0,this.handling=0,this.integrity=0,this.safety=0,this.reliability=0,this.fuel=0,this.stress=0,this.volume=0,this.warnings=[],this.walker_torque=0,e&&(e.cost&&(this.cost=e.cost),e.upkeep&&(this.upkeep=e.upkeep),e.speed&&(this.speed=e.speed),e.torque&&(this.torque=e.torque),e.handling&&(this.handling=e.handling),e.integrity&&(this.integrity=e.integrity),e.safety&&(this.safety=e.safety),e.reliability&&(this.reliability=e.reliability),e.fuel&&(this.fuel=e.fuel),e.stress&&(this.stress=e.stress),e.volume&&(this.volume=e.volume),e.warnings&&(this.warnings=e.warnings))}add(e){this.cost+=e.cost,this.upkeep+=e.upkeep,this.speed+=e.speed,this.torque+=e.torque,this.handling+=e.handling,this.integrity+=e.integrity,this.safety+=e.safety,this.reliability+=e.reliability,this.fuel+=e.fuel,this.stress+=e.stress,this.volume+=e.volume;for(let t of e.warnings)this.warnings.push(t)}Serialize(e){e.PushNum(this.cost),e.PushNum(this.upkeep),e.PushNum(this.speed),e.PushNum(this.torque),e.PushNum(this.handling),e.PushNum(this.integrity),e.PushNum(this.safety),e.PushNum(this.reliability),e.PushNum(this.fuel),e.PushNum(this.stress),e.PushNum(this.volume),e.PushNum(this.walker_torque),e.PushNum(this.warnings.length);for(let t of this.warnings)e.PushString(t.source),e.PushString(t.warning),e.PushNum(t.color.valueOf())}Deserialize(e){this.cost=e.GetNum(),this.upkeep=e.GetNum(),this.speed=e.GetNum(),this.torque=e.GetNum(),this.handling=e.GetNum(),this.integrity=e.GetNum(),this.safety=e.GetNum(),this.reliability=e.GetNum(),this.fuel=e.GetNum(),this.stress=e.GetNum(),this.volume=e.GetNum(),this.walker_torque=e.GetNum();let t=e.GetNum();this.warnings=[];for(let s=0;s<t;s++){let t=e.GetString(),s=e.GetString(),i=e.GetNum();this.warnings.push({source:t,warning:s,color:i})}}}var v=[{HP:10,name:"Motorcycle",speed:3,fuel:15,upkeep:0,reliability:2,cost:-1,special:["Gains 2 Fuel Uses instead of 1 when refuelling from jerry cans and other sources."]},{HP:20,name:"Sedan",speed:4,fuel:13,upkeep:0,reliability:2,cost:0,special:["Gains 2 Fuel Uses instead of 1 when refuelling from jerry cans and other sources."]},{HP:40,name:"Sports Car",speed:5,fuel:12,upkeep:0,reliability:1,cost:1,special:["Gains 2 Fuel Uses instead of 1 when refuelling from jerry cans and other sources."]},{HP:60,name:"Truck",speed:6,fuel:11,upkeep:0,reliability:1,cost:2,special:["Gains 2 Fuel Uses instead of 1 when refuelling from jerry cans and other sources."]},{HP:80,name:"Tankette",speed:7,fuel:10,upkeep:1,reliability:0,cost:3,special:[]},{HP:100,name:"Cable Train",speed:8,fuel:9,upkeep:1,reliability:0,cost:4,special:[]},{HP:120,name:"Light Tank",speed:9,fuel:8,upkeep:1,reliability:-1,cost:5,special:[]},{HP:150,name:"Medium Tank",speed:10,fuel:6,upkeep:2,reliability:-1,cost:6,special:[]},{HP:180,name:"Aircraft",speed:11,fuel:4,upkeep:2,reliability:-2,cost:8,special:[]}],y=[],C=[];for(let e of v){let t=structuredClone(e);t.fuel*=2,y.push(t);let s=structuredClone(e);s.fuel=Math.floor(s.fuel/2),C.push(s)}const S=[{name:"Human Powered",stress:1,integrity:5,powerplants:[{HP:0,name:"Humans",speed:1,cost:-2,special:["Requires 1 human per volume.",'"Engine" takes Injury where they would normally take Wear.',"Reliability modifier is equal to the Higest Attribute."]}],special:[]},{name:"Wind Powered",powerplants:[{HP:0,name:"Sails",special:["Does not need to Crank Start","Cannot Gun the Engine","Does not catch fire at 7 Wear","Max Speed is Wind strength, half that into the wind. This speed is unmodified by Volume.","Requires 1 bold sailor per Volume to man the rigging.","Cannot be armoured."]}],special:[]},{name:"Petrol",powerplants:v,special:[]},{name:"Diesel",cost:2,speed:-1,torque:1,reliability:1,powerplants:y,special:[]},{name:"Steam",cost:-2,speed:-2,torque:2,stress:1,reliability:2,volume:1,integrity:-5,powerplants:C,special:["At 7 Wear, pushes Burn Out as the boiler explodes!","1 Capacity of coal is 3 Fuel Uses."]},{name:"Electric",cost:3,speed:1,torque:-1,handling:5,powerplants:C,special:["Auto-pass Crank Start.","Cannot Gun the Engine.","Must recharge in town or with a generator.","Can be Concealed with the engine on(when stationary)."]},{name:"Clockwork",cost:2,integrity:5,powerplants:C,special:["Auto-pass Crank Start.","Cannot Gun the Engine","Does not burn at 7 Wear.",'On Check Engine, cannot choose to take Wear or shut down; this is replaced with "Spend 1 Fuel Use (repeatable)".',"Must recharge in town or with a generator."]}],k=["Monowheel","Two-Wheeled","Three-Wheeled","Four-Wheeled","Six-Wheeled","Half-Track","Continuous Track","Crawler","Half-Walker","Walker","Skids","Skis","Boat Hull","Amphibious","Cable Car","Sky-Line","Dorandisch Earthline"],x=[{size:e.None,handling:0,speedmod:0,maxHP:0,integrity:0},{size:e.Small,handling:45,speedmod:1,maxHP:20,integrity:6},{size:e.Medium,handling:40,speedmod:1,maxHP:40,integrity:8},{size:e.Medium,handling:35,speedmod:0,maxHP:60,integrity:10},{size:e.Medium,handling:30,speedmod:0,maxHP:80,integrity:12},{size:e.Large,handling:25,speedmod:-1,maxHP:100,integrity:14},{size:e.Large,handling:20,speedmod:-1,maxHP:120,integrity:16},{size:e.Huge,handling:15,speedmod:-1,maxHP:150,integrity:18},{size:e.Huge,handling:10,speedmod:-2,maxHP:180,integrity:20}];class A{constructor(e){this.name=e.name,this.abbr=e.abbr,this.cost=e.cost,this.loader=e.loader??!1,this.heavy=e.heavy??0,this.artillery=e.artillery??!1,this.artillery&&(this.loader=!0)}Serialize(e){e.PushString(this.name),e.PushString(this.abbr),e.PushNum(this.cost),e.PushBool(this.loader),e.PushNum(this.heavy),e.PushBool(this.artillery)}Deserialize(e){this.name=e.GetString(),this.abbr=e.GetString(),this.cost=e.GetNum(),this.loader=e.GetBool(),this.heavy=e.GetNum(),this.artillery=e.GetBool()}}var E=[new A({name:"None",abbr:void 0,cost:void 0,loader:!1}),new A({name:"Searchlight",abbr:"SL",cost:1}),new A({name:"Trench Gun",abbr:"TG",cost:2}),new A({name:"Aircraft Shotgun",abbr:"ASG",cost:2}),new A({name:"Converted Autorifle",abbr:"CAR",cost:1}),new A({name:"Machine Carbine",abbr:"MC",cost:5}),new A({name:"Heavy Submachine Gun",abbr:"HSG",cost:2,loader:!0}),new A({name:"Firing Port Weapon",abbr:"FPW",cost:2}),new A({name:"Landflammenwerfer",abbr:"LFW",cost:3}),new A({name:"Static Gun",abbr:"Static Gun",cost:4}),new A({name:"Light Machine Gun",abbr:"LMG",cost:2,loader:!0}),new A({name:"Water-Cooled Machine Gun",abbr:"WMG",cost:3,loader:!0,heavy:2}),new A({name:"Automatic Rifle",abbr:"AR",cost:3,loader:!0}),new A({name:"Hailstorm Shotgun",abbr:"HSS",cost:4,loader:!0,heavy:3}),new A({name:"Rotary Machine Gun",abbr:"RMG",cost:5,loader:!0,heavy:2}),new A({name:"PuF Machine Gun",abbr:"PMG",cost:5,loader:!0,heavy:3}),new A({name:"Anti-Tank Rifle",abbr:"ATR",cost:4,loader:!1}),new A({name:"Coilgun Rifle",abbr:"Coilgun Rifle",cost:10,loader:!1}),new A({name:"Trench Mortar",abbr:"TM",cost:1,loader:!0}),new A({name:"Repeater Cannon",abbr:"RPC",cost:6,loader:!0,heavy:3}),new A({name:"Infantry Support Cannon",abbr:"ISC",cost:6,heavy:2,artillery:!0}),new A({name:"Recoilless Cannon",abbr:"RRC",cost:5,loader:!0,heavy:2}),new A({name:"Pom-Pom Gun",abbr:"POM",cost:10,artillery:!0,heavy:3}),new A({name:"Flak Cannon",abbr:"FLAK",cost:5,artillery:!0,heavy:3}),new A({name:"Field Cannon",abbr:"FC",cost:8,artillery:!0,heavy:3}),new A({name:"Heavy Field Cannon",abbr:"HFC",cost:15,artillery:!0,heavy:5}),new A({name:"Rocket Artillery Rail",abbr:"RAR",cost:2,artillery:!0,heavy:.5}),new A({name:"Assault Howitzer",abbr:"AH",cost:8,artillery:!0,heavy:4}),new A({name:"Company Mortar",abbr:"Company Mortar",cost:3,artillery:!0,heavy:3}),new A({name:"Light Howitzer",abbr:"Light Howitzer",cost:8,artillery:!0,heavy:4}),new A({name:"Medium Howitzer",abbr:"Medium Howitzer",cost:12,artillery:!0,heavy:5}),new A({name:"Siege Cannon",abbr:"Siege Cannon",cost:16,artillery:!0,heavy:6})],N=[...E];function P(){return N}var G=["None","Lead Gunsight","Binocular Gunsight"];class T{constructor(e,t,s,i,o,r){this.main_idx=e,this.directions=t,this.secondary_idx=s,this.shield=i,this.secondary_idx=this.secondary_idx.filter((e=>e>0)),0==this.main_idx&&this.secondary_idx.length>0&&(this.main_idx=this.secondary_idx[0],this.secondary_idx.splice(0,1)),this.gunsight=o,this.rocket_count=r}Serialize(e){e.PushNum(this.main_idx),e.PushBoolArr(this.directions),e.PushNumArr(this.secondary_idx),e.PushBool(this.shield),e.PushNum(this.gunsight),e.PushNum(this.rocket_count)}Deserialize(e){this.main_idx=e.GetNum(),this.directions=e.GetBoolArr(5),this.secondary_idx=e.GetNumArr(0),this.shield=e.GetBool(),this.gunsight=e.GetNum(),this.rocket_count=e.GetNum()}GetNumLoaders(){this.main_idx=Math.min(N.length-1,this.main_idx);let e=0;N[this.main_idx].loader&&e++;for(let t of this.secondary_idx)N[t].loader&&e++;return e}CalcStats(e,s){this.main_idx=Math.min(N.length-1,this.main_idx);for(let e=0;e<this.secondary_idx.length;e++)this.secondary_idx[e]=Math.min(N.length-1,this.secondary_idx[e]);let i=new b;if(this.main_idx>0){i.add(this.WeapStats(this.main_idx)),N[this.main_idx].artillery&&"ISC"!=N[this.main_idx].abbr?i.cost+=e?this.ArtyDirCost(this.main_idx,s):this.ArtyDirCost(this.main_idx,[0,0,0]):i.cost+=this.NonArtyDirCost();for(let t of this.secondary_idx)i.add(this.WeapStats(t)),i.cost+=3,N[t].artillery&&"ISC"!=N[t].abbr?i.cost+=e?this.ArtyDirCost(t,s):this.ArtyDirCost(t,[0,0,0]):i.cost+=this.NonArtyDirCost();this.shield&&(i.cost+=3),1==this.gunsight?(i.cost+=5,i.warnings.push({source:G[this.gunsight],warning:"When Stationary, reduces Deflection Shot attack penalty by 2 for this weapon mount. Cannot give a bonus.",color:t.WHITE})):2==this.gunsight&&(i.cost+=5,i.warnings.push({source:G[this.gunsight],warning:"When Stationary, reduces Range Band attack penalty by 2 for this weapon mount. Cannot give a bonus.",color:t.WHITE}))}return i}ArtyDirCost(e,t){let s=this.ArmourCost(t),i=this.directions.slice(0,4),o=0;return i.map((o=0,e=>{e&&(o+=1)})),s+=Math.max(o-1,0),this.directions[4]&&"FLAK"!=N[e].abbr&&(s+=3+t[1]),s}NonArtyDirCost(){let e=this.directions.slice(0,4),t=0;e.map((t=0,e=>{e&&(t+=1)}));let s=0;return t>1&&(s+=1),this.directions[4]&&(s+=1),s}WeapStats(e){let t=new b,s=N[e];return t.cost+=s.cost,s.artillery&&"ISC"!=s.abbr&&"RAR"!=s.abbr?(t.volume=Math.ceil(s.heavy/2),t.cost+=2,t.integrity-=3):"RAR"==s.abbr&&(t.cost+=(this.rocket_count-1)*s.cost,t.volume=Math.ceil(s.heavy*this.rocket_count/2),t.cost+=2,t.integrity-=3),t}IsArty(){if(this.main_idx=Math.min(N.length-1,this.main_idx),N[this.main_idx].artillery&&"ISC"!=N[this.main_idx].abbr)return!0;for(let e of this.secondary_idx)if(N[e].artillery&&"ISC"!=N[e].abbr)return!0;return!1}ArmourCost(e){let t=[0];this.directions[0]&&t.push(e[0]),this.directions[1]&&t.push(e[1]),this.directions[3]&&t.push(e[1]),this.directions[2]&&t.push(e[2]),t.sort(),t.pop();let s=0;return t.map((s=0,e=>s+=e)),s}WeaponString(){if(this.main_idx=Math.min(N.length-1,this.main_idx),0==this.main_idx)return"";let e,t=Array(N.length).fill(0);t[this.main_idx]++;for(let e of this.secondary_idx)t[e]++;e="RAR"==N[this.main_idx].abbr?w.Format("{0}x {1}",this.rocket_count,N[this.main_idx].abbr):1==t[this.main_idx]?N[this.main_idx].abbr:w.Format("{0}x {1}",t[this.main_idx],N[this.main_idx].abbr),t[this.main_idx]=0;for(let s=t.length-1;s>0;s--)t[s]>0&&(e+=" +Co-Ax ",1==t[s]?e+=N[s].abbr:e+=w.Format("{0}x {1}",t[s],N[s].abbr));let s=[];this.directions[0]&&this.directions[1]&&this.directions[2]&&this.directions[3]?s.push("All Horizontal"):(this.directions[0]&&s.push("Fore"),this.directions[1]&&s.push("Right"),this.directions[2]&&s.push("Rear"),this.directions[3]&&s.push("Left")),this.directions[4]&&s.push("Up");let i=[];this.shield&&i.push("Gun Shield"),0!=this.gunsight&&i.push(G[this.gunsight]);let o=[w.Format("{0} ({1})",e,w.Join(", ",s)),w.Join(", ",i)];return o=o.filter((e=>0!=e.length)),w.Join(", ",o)}}const I=[{name:"None"},{name:"Driver"},{name:"Commander"},{name:"Gunner"},{name:"Gun Crew"},{name:"Mechanic"},{name:"Passenger"},{name:"Passenger (Cramped)"},{name:"Stretcher"}];class L{constructor(e,t,s,i,o,r,n){this.enclosed=e,this.coupla=t,this.sealed=s,this.loop_front=i,this.loop_left=o,this.loop_right=r,this.loop_back=n}Serialize(e){e.PushBool(this.enclosed),e.PushBool(this.coupla),e.PushBool(this.sealed),e.PushBool(this.loop_front),e.PushBool(this.loop_left),e.PushBool(this.loop_right),e.PushBool(this.loop_back)}Deserialize(e){this.enclosed=e.GetBool(),this.coupla=e.GetBool(),this.sealed=e.GetBool(),this.loop_front=e.GetBool(),this.loop_left=e.GetBool(),this.loop_right=e.GetBool(),this.loop_back=e.GetBool()}}class B{constructor(e,t,s,i,o,r,n,a,l,h){this.name_txt=e,this.enclosed=t,this.coupla=s,this.sealed=i,this.loop_front=o,this.loop_left=r,this.loop_right=n,this.loop_back=a,this.loaders=l,this.weapon_mounts=h}Serialize(e){e.PushString(this.name_txt),e.PushBool(this.enclosed),e.PushBool(this.coupla),e.PushBool(this.sealed),e.PushBool(this.loop_front),e.PushBool(this.loop_left),e.PushBool(this.loop_right),e.PushBool(this.loop_back),e.PushNum(this.loaders.length);for(let t of this.loaders)t.Serialize(e);e.PushNum(this.weapon_mounts.length);for(let t of this.weapon_mounts)t.Serialize(e)}Deserialize(e){this.name_txt=e.GetString(),this.enclosed=e.GetBool(),this.coupla=e.GetBool(),this.sealed=e.GetBool(),this.loop_front=e.GetBool(),this.loop_left=e.GetBool(),this.loop_right=e.GetBool(),this.loop_back=e.GetBool();let t=e.GetNum();this.loaders=[];for(let s=0;s<t;s++){let t=new L(!1,!1,!1,!1,!1,!1,!1);t.Deserialize(e),this.loaders.push(t)}let s=e.GetNum();this.weapon_mounts=[];for(let t=0;t<s;t++){let t=new T(0,[],[],!1,0,0);t.Deserialize(e),this.weapon_mounts.push(t)}}IsEnclosed(){let e=!1;e=e||this.enclosed;for(let t=0;t<this.loaders.length;t++)e=e||this.loaders[t].enclosed;return e}GetVisibility(e){let t;if(t=null==e?this:this.loaders[e],!t.sealed)return t.enclosed?t.coupla?this.base_vis+1:this.base_vis:void 0}GetNumLoaders(){let e=0;for(let t of this.weapon_mounts)e+=t.GetNumLoaders();return e}GetEscape(e){let t;if(t=null==e?this:this.loaders[e],t.enclosed)return t.coupla?this.base_escape+1:this.base_escape}GetLoopholes(){let e={f:0,l:0,r:0,b:0};for(let t of[this,...this.loaders])t.loop_front&&(e.f+=1),t.loop_left&&(e.l+=1),t.loop_right&&(e.r+=1),t.loop_back&&(e.b+=1);return e}IsCramped(){return this.name_txt==I[7].name}WeaponString(){let e=[];for(let t of this.weapon_mounts)e.push(t.WeaponString());return w.Join(", ",e)}CalcStats(e){for(;this.loaders.length>this.GetNumLoaders();)this.loaders.pop();if(e[0]+e[1]+e[2]==0){this.coupla=!1;for(let e of this.loaders)e.coupla=!1}let t=new b;this.name_txt==I[7].name?t.volume+=0:this.name_txt==I[8].name?t.volume+=1:t.volume+=.5,this.enclosed&&this.coupla&&(t.cost+=1);for(let e=0;e<this.loaders.length;e++)t.volume+=.5,this.loaders[e].enclosed&&this.loaders[e].coupla&&(t.cost+=1);for(let s of this.weapon_mounts)t.add(s.CalcStats(this.enclosed,e));return t}}class W{Serialize(e){e.PushBool(this.extra_armour),e.PushBool(this.wooden_armour),e.PushBool(this.cruise_control),e.PushBool(this.intercom),e.PushBool(this.wireless),e.PushBool(this.temp_control),e.PushBool(this.gas_filters),e.PushBool(this.dozer_blades),e.PushBool(this.wire_cutters),e.PushBool(this.clockwerk_missile),e.PushBool(this.smokescreen),e.PushBool(this.camouflage),e.PushBool(this.steering_trailer)}Deserialize(e){this.extra_armour=e.GetBool(),this.wooden_armour=e.GetBool(),this.cruise_control=e.GetBool(),this.intercom=e.GetBool(),this.wireless=e.GetBool(),this.temp_control=e.GetBool(),this.gas_filters=e.GetBool(),this.dozer_blades=e.GetBool(),this.wire_cutters=e.GetBool(),this.clockwerk_missile=e.GetBool(),this.smokescreen=e.GetBool(),this.camouflage=e.GetBool(),this.steering_trailer=e.GetBool()}Reset(){this.extra_armour=!1,this.wooden_armour=!1,this.cruise_control=!1,this.intercom=!1,this.wireless=!1,this.temp_control=!1,this.gas_filters=!1,this.dozer_blades=!1,this.wire_cutters=!1,this.clockwerk_missile=!1,this.smokescreen=!1,this.camouflage=!1,this.steering_trailer=!1}GetEscapeMod(){let e=0;return this.wooden_armour&&(e-=1),e}CalcStats(e,s){return this.is_enclosed=e,this.extra_armour&&(s.safety*=2,s.reliability-=1),this.wooden_armour&&s.warnings.push({source:"Wooden Spaced Armour",warning:"Disadvantage to attacks with Tank Breakers.",color:t.WHITE}),this.cruise_control&&(s.cost+=6,s.warnings.push({source:"Cruise Control",warning:"Works like a programmable autopilot, able toexecute a series of orders. Cannot React.",color:t.WHITE})),this.intercom&&(s.cost+=3,s.warnings.push({source:"Crew Intercom",warning:"+2 to Peek/Peer Out for all positions, so long as at least two are manned.",color:t.WHITE})),this.wireless&&(s.cost+=4,s.warnings.push({source:"Wireless Set",warning:"Adds a wireless set to a seat chosen now. Operating the radio takes both hands and distracts from normal tasks.",color:t.WHITE})),this.is_enclosed?(this.temp_control&&(s.cost+=4,s.warnings.push({source:"Temperature Control",warning:"Until a hatch is open, treat the temperature in the vehicle as one band lower or higher as desired.",color:t.WHITE})),this.gas_filters&&(s.cost+=5,s.reliability-=1,s.warnings.push({source:"Gas Filters",warning:"When all hatches are closed and the engine is running, is immune to poison gas.",color:t.WHITE}))):(this.temp_control=!1,this.gas_filters=!1),this.dozer_blades&&(s.cost+=3,s.warnings.push({source:"Dozer Blades",warning:"Mark 1 RPM to raise/lower. When lowered, reduce Max Speed to 2, use your Front Armour against mines, and gain double bonus from Gunning the Engine for Cross Obstacle. Can be used to create berms for cover in a few minutes.",color:t.WHITE})),this.wire_cutters&&(s.cost+=2,s.warnings.push({source:"Wire Cutters",warning:"Clears any barbed wire the vehicle passes through, leaving no danger to following troops.",color:t.WHITE})),this.clockwerk_missile&&(s.cost+=5,s.warnings.push({source:"Clockwerk Missile Rail",warning:"Disposable. Reloads 5þ each.",color:t.WHITE})),this.smokescreen&&(s.cost+=4,s.warnings.push({source:"Smokescreen Launcher",warning:"Hold 1 per mission. Spend the hold to spread a smokescreen(page 136), covering everything within Close range of the front of the vehicle.",color:t.WHITE})),this.camouflage&&(s.cost+=2,s.warnings.push({source:"Camouflage",warning:"While stationary with the engine off in your chosen biome, the vehicle cannot be seen or attacked by aircraft unless they come down to treetop height.",color:t.WHITE})),this.steering_trailer&&(s.cost+=6,s.warnings.push({source:"Steering Trailer",warning:"At Speed 2 or less, +5 Handling, +2 Torque. You may negate an 11-15 on Cross Obstacle by cutting the trailer loose and leaving it behind.",color:t.WHITE})),s}}class H{constructor(){this.weapons=[],this.parts=[]}Serialize(e){e.PushNum(this.weapons.length);for(let t of this.weapons)t.Serialize(e);e.PushNum(this.parts.length);for(let t of this.parts)e.PushString(t.name),t.stats.Serialize(e)}Deserialize(e){let t=e.GetNum();this.weapons=[];for(let s=0;s<t;s++)this.weapons.push(new A({name:"",abbr:"",cost:0})),this.weapons[s].Deserialize(e);let s=e.GetNum();this.parts=[];for(let t=0;t<s;t++)this.parts.push({name:e.GetString(),stats:new b}),this.parts[t].stats.Deserialize(e)}SetWeapon(e,t,s,i,o,r){r&&(o=Math.max(1,Math.floor(1e-6+o)),i=!0),s=Math.floor(1e-6+s),e>=0&&e<this.weapons.length?this.weapons[e]=new A({name:t,abbr:t,cost:s,loader:i,heavy:o,artillery:r}):console.error("Custom SetWeapon index out of range")}RemoveWeapon(){this.weapons.pop()}AddWeapon(){this.weapons.push(new A({name:"Default",abbr:"Default",cost:0}))}GetWeapons(){return this.weapons}SetPart(e,t,s){e>=0&&e<this.parts.length?this.parts[e]={name:t,stats:s}:console.error("Custom SetPart index out of range")}RemovePart(){this.parts.pop()}AddPart(){this.parts.push({name:"Default",stats:new b({warnings:[{source:"Default",warning:"No Special Rules",color:t.YELLOW}]})})}GetParts(){return this.parts}Reset(){this.parts=[],this.weapons=[]}}class R{constructor(){this.version=2,this.name="Sample Vehicle",this.nickname="It Only Gets Worse.",this.powerplant_idx=2,this.powerplant_size_idx=1,this.locomotion_idx=3,this.armour_front=0,this.armour_side=0,this.armour_rear=0,this.extra_fuel=0,this.extra_tiny=!1,this.enlarged_engine=0,this.propeller=!1,this.turret_hull=!1,this.crew=[new B("Driver",!0,!0,!1,!1,!1,!1,!1,[],[]),new B("Commander",!0,!0,!1,!1,!1,!1,!1,[],[new T(0,[!0,!1,!1,!1,!1],[],!1,0,0)])],this.cargo=[0,0,0,0],this.accessories=new W,this.custom=new H}Serialize(e){e.PushString(this.version.toString()),e.PushString(this.name),e.PushString(this.nickname),e.PushNum(this.powerplant_idx),e.PushNum(this.powerplant_size_idx),e.PushNum(this.locomotion_idx),e.PushNum(this.armour_front),e.PushNum(this.armour_side),e.PushNum(this.armour_rear),e.PushNum(this.extra_fuel),e.PushNum(this.enlarged_engine),e.PushBool(this.propeller),e.PushBool(this.turret_hull),e.PushNum(this.crew.length);for(let t of this.crew)t.Serialize(e);e.PushNum(this.cargo[0]),e.PushNum(this.cargo[1]),e.PushNum(this.cargo[2]),e.PushNum(this.cargo[3]),this.accessories.Serialize(e),this.custom.Serialize(e)}Deserialize(e){e.version=parseFloat(e.GetString()),this.name=e.GetString(),this.nickname=e.GetString(),this.powerplant_idx=e.GetNum(),this.powerplant_size_idx=e.GetNum(),this.locomotion_idx=e.GetNum(),this.armour_front=e.GetNum(),this.armour_side=e.GetNum(),this.armour_rear=e.GetNum(),this.extra_fuel=e.GetNum(),this.enlarged_engine=e.GetNum(),this.propeller=e.GetBool(),this.turret_hull=e.GetBool();let t=e.GetNum();this.crew=[];for(let s=0;s<t;s++){let t=new B("",!1,!1,!1,!1,!1,!1,!1,[],[]);t.Deserialize(e),this.crew.push(t)}this.cargo=[e.GetNum(),e.GetNum(),e.GetNum(),e.GetNum()],this.accessories.Deserialize(e),e.version>1&&this.custom.Deserialize(e)}SetDisplayCallback(e){this.DisplayCallback=e}ValidateArmour(){for("Wind Powered"==S[this.powerplant_idx].name&&0!=this.SumArmour()&&(this.armour_front=0,this.armour_side=0,this.armour_rear=0),this.armour_front=Math.min(5,this.armour_front),this.armour_side=Math.min(5,this.armour_side),this.armour_rear=Math.min(5,this.armour_rear);this.SumArmour()>10;)0!=this.armour_rear?this.armour_rear--:0!=this.armour_side?this.armour_side--:this.armour_front--}SumArmour(){return this.armour_front+this.armour_side+this.armour_rear}SetCargo(e,t,s,i){this.cargo=[e,t,s,i],this.CalculateStats()}GetCargo(){let e=0;return this.extra_tiny&&(e+=1),[e,...this.cargo]}SetPowerplant(e){S[this.powerplant_idx].powerplants.length!=S[e].powerplants.length&&(this.powerplant_size_idx=Math.min(1,S[e].powerplants.length-1)),this.powerplant_idx=e,this.ValidateArmour(),this.CalculateStats()}GetPowerplantIdx(){return this.powerplant_idx}GetPowerplant(){return structuredClone(S[this.powerplant_idx])}GetPowerplantList(){return S}GetPowerplantSizeIdx(){return this.powerplant_size_idx}SetPowerplantSize(e){this.powerplant_size_idx=e,this.CalculateStats()}GetPowerplantSize(){return S[this.powerplant_idx].powerplants[this.powerplant_size_idx]}GetPowerplantSizeList(){return S[this.powerplant_idx].powerplants}GetPropulsionList(){return k}SetPropulsion(e){this.locomotion_idx=e,this.CalculateStats()}GetPropulsionIdx(){return this.locomotion_idx}GetPropulsion(){return k[this.locomotion_idx]}SetPropeller(e){this.propeller=e,this.CalculateStats()}CanPropeller(){switch(k[this.locomotion_idx]){case"Half-Track":case"Continuous Track":case"Crawler":case"Half-Walker":case"Walker":return!1;case"Monowheel":case"Two-Wheeled":case"Three-Wheeled":case"Four-Wheeled":case"Six-Wheeled":if(this.GetVolume()>4)return!1;case"Skids":case"Skis":case"Boat Hull":case"Amphibious":case"Cable Car":case"Sky-Line":case"Dorandisch Earthline":if("Wind Powered"==S[this.powerplant_idx].name)return!1}return!0}ValidateLocomotion(){let e=this.GetVolume();switch(k[this.locomotion_idx]){case"Monowheel":case"Two-Wheeled":return e<=1;case"Three-Wheeled":case"Four-Wheeled":case"Six-Wheeled":case"Half-Track":case"Continuous Track":case"Crawler":case"Half-Walker":case"Walker":return e<=8;case"Skids":case"Skis":return e<=6;case"Boat Hull":case"Amphibious":case"Cable Car":case"Sky-Line":case"Dorandisch Earthline":return!0;default:return console.error("Unknonw Locomotion in ValidateLocomotion"),!1}}SetArmourFront(e){for(e=Math.floor(1e-6+e),e=Math.max(0,e),e=Math.min(5,e),this.armour_front=e;this.SumArmour()>10;)this.armour_front--;this.ValidateArmour(),this.CalculateStats()}GetArmourFront(){return this.armour_front}SetArmourSide(e){for(e=Math.floor(1e-6+e),e=Math.max(0,e),e=Math.min(5,e),this.armour_side=e;this.SumArmour()>10;)this.armour_side--;this.ValidateArmour(),this.CalculateStats()}GetArmourSide(){return this.armour_side}SetArmourRear(e){for(e=Math.floor(1e-6+e),e=Math.max(0,e),e=Math.min(5,e),this.armour_rear=e;this.SumArmour()>10;)this.armour_rear--;this.ValidateArmour(),this.CalculateStats()}GetArmourRear(){return this.armour_rear}CanExtraFuel(){return(this.GetPowerplantSize().fuel??0)>0}SetExtraFuel(e){e=Math.floor(1e-6+e),e=Math.max(0,e),this.extra_fuel=e,this.CalculateStats()}GetExtraFuel(){return this.extra_fuel}SetEnlargeEngine(e){this.enlarged_engine=e,this.CalculateStats()}GetEnlargedEngine(){return this.enlarged_engine}GetVolume(){let e=new b;e.volume+=this.extra_fuel;let t=[this.armour_front,this.armour_side,this.armour_rear],s=!1,i=0;for(let o=0;o<this.crew.length;o++)s=s||this.crew[o].IsEnclosed(),e.add(this.crew[o].CalcStats(t)),this.crew[o].IsCramped()&&(i+=.25);e.volume+=Math.ceil(-1e-6+i);for(let t of this.custom.GetParts())e.volume+=t.stats.volume;return e.volume=Math.ceil(-1e-6+e.volume),s&&(e.volume+=1),"Amphibious"==k[this.locomotion_idx]&&(e.volume+=1),this.enlarged_engine>0&&(e.volume+=this.enlarged_engine),e.volume+=1*this.cargo[0],e.volume+=2*this.cargo[1],e.volume+=4*this.cargo[2],e.volume+=8*this.cargo[3],e.add(new b(S[this.powerplant_idx])),e.volume}CalculateStats(){var e;e=this.custom.GetWeapons(),N=[...E,...e];let i=[this.armour_front,this.armour_side,this.armour_rear];this.CanExtraFuel()||(this.extra_fuel=0);let o=new b;o.cost=3,o.torque=-1,o.volume+=this.extra_fuel;let r=!1,n=0;for(let e=0;e<this.crew.length;e++)r=r||this.crew[e].IsEnclosed(),o.add(this.crew[e].CalcStats(i)),this.crew[e].IsCramped()&&(n+=.25);r&&(o.volume+=1,this.SumArmour()>0&&(o.stress+=1)),this.extra_tiny=o.volume-Math.floor(o.volume)>=.45,o.volume+=n;for(let e of this.custom.GetParts())o.add(e.stats);o.volume=Math.ceil(o.volume),o.cost+=this.GetLoopholes(),this.ValidateLocomotion()||o.warnings.push({source:k[this.locomotion_idx],warning:"Too much Volume for this locomotion type.",color:t.RED}),"Amphibious"==k[this.locomotion_idx]&&(o.volume+=1,o.cost+=1,o.warnings.push({source:"Amphibious",warning:"Allows use on calm water at -1 Speed.",color:t.WHITE})),o.volume+=1*this.cargo[0],o.volume+=2*this.cargo[1],o.volume+=4*this.cargo[2],o.volume+=8*this.cargo[3],o.add(new b(S[this.powerplant_idx]));for(let e of S[this.powerplant_idx].special)o.warnings.push({source:S[this.powerplant_idx].name,warning:e,color:t.WHITE});let a=o.volume;this.enlarged_engine&&(o.volume+=this.enlarged_engine,o.reliability-=this.enlarged_engine,a+=2*this.enlarged_engine),a=Math.min(x.length-1,a),o.handling+=x[Math.min(x.length-1,o.volume)].handling,o.speed+=x[Math.min(x.length-1,o.volume)].speedmod,o.integrity+=x[Math.min(x.length-1,o.volume)].integrity,v[this.powerplant_size_idx].HP>x[a].maxHP&&o.warnings.push({source:"Powerplant Size",warning:"Powerplant is too large for this vehicle. Add Volume, expand the engine compartment, or reduce the engine size.",color:t.RED}),o.add(new b(S[this.powerplant_idx].powerplants[this.powerplant_size_idx]));for(let e of S[this.powerplant_idx].powerplants[this.powerplant_size_idx].special)o.warnings.push({source:S[this.powerplant_idx].powerplants[this.powerplant_size_idx].name,warning:e,color:t.WHITE});o.fuel*=this.extra_fuel+1;let l=this.SumArmour();o.cost+=l,o.handling-=2*l,o.safety+=Math.floor((Math.max(...i)+Math.min(...i))/2),i.forEach((e=>{e>=3&&(o.safety+=1,o.speed-=1,o.torque-=1)})),l>0&&(o.speed-=1,o.torque-=1,o.integrity+=2+l,l>=5&&(o.speed-=1,o.torque-=1,l>=10&&(o.speed-=1,o.torque-=1))),o.reliability-=Math.floor(1e-6+l/3);let h=0;l>=1&&(h-=1,l>=4&&(h-=1,l>=7&&(h-=1,l>=10&&(h-=1))));for(let e of this.crew)e.base_vis=h,e.base_escape=h+this.accessories.GetEscapeMod();switch(this.propeller&&this.CanPropeller()&&(o.torque-=2,o.speed+=1,o.reliability+=1,o.stress+=1,o.warnings.push({source:"Propeller",warning:"Double Injury on a Crash.",color:t.WHITE})),this.turret_hull&&this.CanTurretHull()&&(o.cost+=10,o.warnings.push({source:"Turret Hull",warning:"Gains the Gyro-Stabilized rule, and does not take the Tank Battle! penalty for single-arc weapons.",color:t.WHITE})),k[this.locomotion_idx]){case"Monowheel":case"Two-Wheeled":o.speed+=1,o.torque-=l,o.cost-=1;break;case"Three-Wheeled":case"Four-Wheeled":o.volume>=6&&(o.torque-=1),o.torque-=Math.floor(l/3);break;case"Six-Wheeled":o.handling-=5,o.torque-=Math.floor(l/5);break;case"Half-Track":o.torque+=2,o.speed-=1,o.cost+=1;break;case"Continuous Track":o.torque+=4,o.speed-=2,o.handling-=5,"Large"==x[Math.min(x.length-1,o.volume)].size?o.torque+=1:"Huge"==x[Math.min(x.length-1,o.volume)].size&&(o.torque+=2),o.cost+=2;break;case"Crawler":case"Half-Walker":o.speed-=2,o.handling-=5,o.walker_torque=3,o.speed=Math.min(o.speed,4),o.cost+=2,o.warnings.push({source:k[this.locomotion_idx],warning:"Gains the High Ground Pressure special rule.",color:t.WHITE});break;case"Walker":o.speed-=3,o.reliability-=1,o.handling+=5,o.upkeep+=1,o.torque-=1,o.walker_torque=5,o.speed=Math.min(o.speed,3),o.cost+=2,o.warnings.push({source:k[this.locomotion_idx],warning:"Gains the High Ground Pressure & Standing Tall special rules.",color:t.WHITE});break;case"Skids":case"Skis":o.speed-=2,o.torque-=2,o.warnings.push({source:k[this.locomotion_idx],warning:"+3 Speed bonus on Snow & Ice.",color:t.WHITE});break;case"Boat Hull":o.speed=Math.min(o.speed,4),o.cost+=1,o.warnings.push({source:k[this.locomotion_idx],warning:"Limited to Water.",color:t.WHITE});break;case"Amphibious":break;case"Cable Car":case"Sky-Line":o.reliability+=4,o.speed+=1,o.warnings.push({source:k[this.locomotion_idx],warning:"Limited to cable lines.",color:t.WHITE});break;case"Dorandisch Earthline":o.reliability+=6,o.speed+=3,o.warnings.push({source:k[this.locomotion_idx],warning:"Limited to ground rails.",color:t.WHITE})}o=this.accessories.CalcStats(r,o),this.DisplayCallback&&this.DisplayCallback(o);let c=new f;this.Serialize(c);const u=m(c.FinalArray()),d=s.compressToEncodedURIComponent(u);return window.localStorage.setItem("tank",d),o}SetCrew(e,t){e==this.crew.length?this.crew.push(t):e>=0&&e<this.crew.length?(t.loaders=this.crew[e].loaders,t.weapon_mounts=this.crew[e].weapon_mounts,this.crew[e]=t):console.error("SetCrew index out of range."),this.CalculateStats()}DeleteCrew(e){this.crew.splice(e,1),this.CalculateStats()}DuplicateCrew(e){let t=this.crew[e],s=[];for(let e of t.loaders)s.push(new L(e.enclosed,e.coupla,e.sealed,e.loop_front,e.loop_left,e.loop_right,e.loop_back));let i=[];for(let e of t.weapon_mounts)i.push(new T(e.main_idx,structuredClone(e.directions),structuredClone(e.secondary_idx),e.shield,e.gunsight,e.rocket_count));let o=new B(t.name_txt,t.enclosed,t.coupla,t.sealed,t.loop_front,t.loop_left,t.loop_right,t.loop_back,s,i);this.crew.splice(e,0,o),this.CalculateStats()}SetLoader(e,t,s){e>=this.crew.length&&console.error("SetLoader crew index out of range.");let i=this.crew[e];t>=i.loaders.length?console.error("SetLoader loader index out of range."):i.loaders[t]=s,this.CalculateStats()}SetNumLoaders(e,t){if(e>=this.crew.length&&console.error("SetNumLoaders crew index out of range."),t<=0)this.crew[e].loaders=[];else{for(t=Math.min(t,this.crew[e].GetNumLoaders());this.crew[e].loaders.length>t;)this.crew[e].loaders.pop();for(;this.crew[e].loaders.length<t;)this.crew[e].loaders.push(new L(!1,!1,!1,!1,!1,!1,!1))}this.CalculateStats()}SetNumWeapons(e,t){if(e>=this.crew.length&&console.error("SetNumWeapons crew index out of range."),t<=0)this.crew[e].weapon_mounts=[];else{for(;this.crew[e].weapon_mounts.length>t;)this.crew[e].weapon_mounts.pop();for(;this.crew[e].weapon_mounts.length<t;)this.crew[e].weapon_mounts.push(new T(0,[!0,!1,!1,!1,!1],[],!1,0,1))}this.CalculateStats()}GetCrewList(){return this.crew}GetNumWeapons(){let e=0;for(let t of this.crew)e+=t.weapon_mounts.length;return e}SetWeapon(e,t){let s=0;for(let i=0;i<this.crew.length;++i)for(let o=0;o<this.crew[i].weapon_mounts.length;o++){if(e==s)return this.crew[i].weapon_mounts[o]=t,void this.CalculateStats();s++}console.error("Index not found")}GetLoopholes(){let e={f:0,s:0,b:0};for(let t of this.crew){let s=t.GetLoopholes();e.f+=s.f,e.s+=s.l,e.s+=s.r,e.b+=s.b}let t=0;for(;e.f>4;)e.f-=4,t+=this.armour_front;for(;e.s>4;)e.s-=4,t+=this.armour_side;for(;e.b>4;)e.b-=4,t+=this.armour_rear;let s=[...Array(e.f).fill(this.armour_front),...Array(e.s).fill(this.armour_side),...Array(e.b).fill(this.armour_rear)];for(s.sort();s.length>0;){let e=s.pop();s.length>0&&s.pop(),s.length>0&&s.pop(),s.length>0&&s.pop(),t+=e}return t}GetAccessories(){return this.accessories}CanTurretHull(){return"Walker"==k[this.locomotion_idx]}SetTurretHull(e){this.turret_hull=e,this.CalculateStats()}Reset(){this.name="Sample Vehicle",this.nickname="It Only Gets Worse.",this.powerplant_idx=2,this.powerplant_size_idx=1,this.locomotion_idx=3,this.armour_front=0,this.armour_side=0,this.armour_rear=0,this.extra_fuel=0,this.extra_tiny=!1,this.enlarged_engine=0,this.propeller=!1,this.turret_hull=!1,this.crew=[new B("Driver",!0,!0,!1,!1,!1,!1,!1,[],[]),new B("Commander",!0,!0,!1,!1,!1,!1,!1,[],[new T(0,[!0,!1,!1,!1,!1],[],!1,0,0)])],this.cargo=[0,0,0,0],this.accessories.Reset(),this.custom.Reset(),this.CalculateStats()}GetCustom(){return this.custom}}class U{constructor(e){this.vehicle=e,this.name_lbl=document.getElementById("lbl_name"),this.nick_lbl=document.getElementById("lbl_nickname"),this.name_inp=document.getElementById("inp_name"),this.nick_inp=document.getElementById("inp_nick"),this.name_inp.onchange=()=>{this.vehicle.name=this.name_inp.value,this.vehicle.CalculateStats()},this.nick_inp.onchange=()=>{this.vehicle.nickname=this.nick_inp.value,this.vehicle.CalculateStats()},this.CreateStatTable(),this.CreateCrewTable()}CreateStatTable(){var e=document.getElementById("tbl_derived"),t=e.insertRow();this.AddHeader(t,"Speed").classList.add("thirdwidth"),this.AddHeader(t,"Torque").classList.add("thirdwidth"),this.AddHeader(t,"Handling").classList.add("thirdwidth");var s=e.insertRow();this.spd=this.AddData(s),this.trq=this.AddData(s),this.hnd=this.AddData(s);var i=e.insertRow();this.AddHeader(i,"Armour"),this.AddHeader(i,"Integrity"),this.AddHeader(i,"Safety");var o=e.insertRow();this.amr=this.AddData(o),this.int=this.AddData(o),this.sft=this.AddData(o);var r=e.insertRow();this.AddHeader(r,"Reliability"),this.AddHeader(r,"Fuel Uses"),this.AddHeader(r,"Stress");var n=e.insertRow();this.rel=this.AddData(n),this.ful=this.AddData(n),this.str=this.AddData(n);var a=e.insertRow();this.sze=a.insertCell(),this.sze.colSpan=3,this.crg=a.insertCell(),this.crg.colSpan=3;var l=e.insertRow();this.special=l.insertCell(),this.special.colSpan=6}CreateCrewTable(){this.crw=document.getElementById("tbl_crew");var e=this.crw.insertRow(),t=this.AddData(e);t.colSpan=4,t.classList.add("tl"),this.AddHeader(e,"Type").colSpan=1,this.AddHeader(e,"Vis.").colSpan=1,this.AddHeader(e,"Escape").colSpan=1,this.AddHeader(e,"Notes").colSpan=1}AddHeader(e,t){var s=document.createElement("TH");return e.appendChild(s),s.colSpan=2,s.textContent=t,s}AddData(e){var t=e.insertCell();return t.colSpan=2,t}CrewLine(e,t,s,i,o,r=!1){var n=this.crw.insertRow();r&&n.insertCell().classList.add("borderless");var a=n.insertCell();a.textContent=e,a.colSpan=r?3:4,n.insertCell().textContent=t,n.insertCell().textContent=(s??"-").toString(),n.insertCell().textContent=(i??"-").toString(),n.insertCell().textContent=o}UpdateDisplay(e){this.name_inp.value=this.vehicle.name,this.nick_inp.value=this.vehicle.nickname,this.name_lbl.innerHTML=w.Format('<p><span style="float:left;">{0}</span> <span style="float:right">{1}þ</span></p>',this.vehicle.name,e.cost),this.nick_lbl.innerHTML=w.Format('<p><span style="float:left;">{0}</span> <span style="float:right">Upkeep {1}þ</span></p>',this.vehicle.nickname,e.upkeep),this.spd.textContent=e.speed.toString(),e.walker_torque?this.trq.textContent=w.Format("+{0}/{1}",e.walker_torque,e.torque):this.trq.textContent=e.torque.toString(),this.hnd.textContent=e.handling.toString(),this.amr.textContent=w.Format("{0}/{1}/{2}",this.vehicle.GetArmourFront(),this.vehicle.GetArmourSide(),this.vehicle.GetArmourRear()),this.int.textContent=e.integrity.toString(),this.sft.textContent=e.safety.toString(),this.rel.textContent=e.reliability.toString(),this.ful.textContent=e.fuel.toString(),this.str.textContent=e.stress.toString(),this.sze.textContent=x[Math.min(e.volume,x.length-1)].size.toString()+w.Format(" ({0} Volume)",e.volume);let s=this.vehicle.GetCargo(),i=[];s[0]>0&&i.push(w.Format("{0} Tiny Cargo",s[0])),s[1]>0&&i.push(w.Format("{0} Small Cargo",s[1])),s[2]>0&&i.push(w.Format("{0} Medium Cargo",s[2])),s[3]>0&&i.push(w.Format("{0} Large Cargo",s[3])),s[4]>0&&i.push(w.Format("{0} Huge Cargo",s[4])),0==i.length&&i.push("No Cargo Space"),this.crg.textContent=w.Join(", ",i),e.warnings.sort(((e,t)=>e.color-t.color));var o="";for(let s of e.warnings){switch(s.color){case t.RED:o+='<div style="color:#FF0000;">';break;case t.YELLOW:o+='<div style="color:#FFFF00;">';break;case t.WHITE:default:o+='<div style="color:var(--inp_txt_color);;">'}o+=s.source+":  "+s.warning+"</div>"}for(this.special.innerHTML=o;this.crw.rows.length>1;)this.crw.deleteRow(1);var r=this.vehicle.GetCrewList();for(let e of r){let t="Exposed";e.enclosed&&(t="Closed",e.sealed&&(t="Sealed"));let s=[];e.enclosed&&e.coupla&&s.push("Hatch"),s.push(e.WeaponString()),this.CrewLine(e.name_txt,t,e.GetVisibility(),e.GetEscape(),w.Join(", ",s));for(let t=0;t<e.loaders.length;t++){let s="Exposed";e.loaders[t].enclosed&&(s="Closed",e.loaders[t].sealed&&(s="Sealed"));let i=[];e.loaders[t].enclosed&&e.loaders[t].coupla&&i.push("Hatch"),this.CrewLine("Loader",s,e.GetVisibility(t),e.GetEscape(t),w.Join(", ",i),!0)}}}}class M{constructor(e){this.update_type=!0,this.vehicle=e,this.locomotion=document.getElementById("sel_loco");for(let e of this.vehicle.GetPropulsionList()){let t=document.createElement("OPTION");t.value=e,t.text=e,this.locomotion.append(t)}this.locomotion.onchange=()=>{this.vehicle.SetPropulsion(this.locomotion.selectedIndex)},this.prop_span=document.getElementById("prop_span"),this.propeller=document.getElementById("inp_prop"),this.propeller.onchange=()=>{this.vehicle.SetPropeller(this.propeller.checked)},this.turret_span=document.getElementById("turret_span"),this.turret=document.getElementById("inp_turret"),this.turret.onchange=()=>{this.vehicle.SetTurretHull(this.turret.checked)},this.pp_type=document.getElementById("sel_pptype"),this.pp_type.onchange=()=>{this.update_type=!0,this.vehicle.SetPowerplant(this.pp_type.selectedIndex)};for(let e of this.vehicle.GetPowerplantList()){let t=document.createElement("OPTION");t.value=e.name,t.text=e.name,this.pp_type.append(t)}this.pp_size=document.getElementById("sel_ppsize"),this.pp_size.onchange=()=>{this.vehicle.SetPowerplantSize(this.pp_size.selectedIndex)},this.SetSizeSel(),this.enlarged_engine=document.getElementById("inp_enlarge"),this.enlarged_engine.min="0",this.enlarged_engine.step="1",this.enlarged_engine.onchange=()=>{this.vehicle.SetEnlargeEngine(this.enlarged_engine.valueAsNumber)},this.extra_fuel=document.getElementById("inp_fuel"),this.extra_fuel.min="0",this.extra_fuel.step="1",this.extra_fuel.onchange=()=>{this.vehicle.SetExtraFuel(this.extra_fuel.valueAsNumber)},this.front_armour=document.getElementById("inp_farm"),this.front_armour.min="0",this.front_armour.step="1",this.front_armour.onchange=()=>{this.vehicle.SetArmourFront(this.front_armour.valueAsNumber)},this.side_armour=document.getElementById("inp_sarm"),this.side_armour.min="0",this.side_armour.step="1",this.side_armour.onchange=()=>{this.vehicle.SetArmourSide(this.side_armour.valueAsNumber)},this.rear_armour=document.getElementById("inp_rarm"),this.rear_armour.min="0",this.rear_armour.step="1",this.rear_armour.onchange=()=>{this.vehicle.SetArmourRear(this.rear_armour.valueAsNumber)},this.s_cargo=document.getElementById("inp_scargo"),this.m_cargo=document.getElementById("inp_mcargo"),this.l_cargo=document.getElementById("inp_lcargo"),this.h_cargo=document.getElementById("inp_hcargo"),this.s_cargo.min="0",this.m_cargo.min="0",this.l_cargo.min="0",this.h_cargo.min="0",this.s_cargo.step="1",this.m_cargo.step="1",this.l_cargo.step="1",this.h_cargo.step="1",this.s_cargo.onchange=()=>{this.vehicle.SetCargo(this.s_cargo.valueAsNumber,this.m_cargo.valueAsNumber,this.l_cargo.valueAsNumber,this.h_cargo.valueAsNumber)},this.m_cargo.onchange=()=>{this.vehicle.SetCargo(this.s_cargo.valueAsNumber,this.m_cargo.valueAsNumber,this.l_cargo.valueAsNumber,this.h_cargo.valueAsNumber)},this.l_cargo.onchange=()=>{this.vehicle.SetCargo(this.s_cargo.valueAsNumber,this.m_cargo.valueAsNumber,this.l_cargo.valueAsNumber,this.h_cargo.valueAsNumber)},this.h_cargo.onchange=()=>{this.vehicle.SetCargo(this.s_cargo.valueAsNumber,this.m_cargo.valueAsNumber,this.l_cargo.valueAsNumber,this.h_cargo.valueAsNumber)}}SetSizeSel(){for(this.update_type=!1;this.pp_size.options.length;)this.pp_size.options.remove(0);for(let e of this.vehicle.GetPowerplantSizeList()){let t=document.createElement("OPTION");t.value=w.Format("{0}HP {1}",e.HP,e.name),t.text=w.Format("{0}HP {1}",e.HP,e.name),this.pp_size.append(t)}}UpdateLocomotion(){let e=this.vehicle.GetVolume();for(let t of this.locomotion.options){switch(t.text){case"Monowheel":case"Two-Wheeled":if(e>1){t.disabled=!0;continue}break;case"Three-Wheeled":case"Four-Wheeled":case"Six-Wheeled":case"Half-Track":case"Continuous Track":case"Crawler":case"Half-Walker":case"Walker":if(e>8){t.disabled=!0;continue}break;case"Skids":case"Skis":if(e>6){t.disabled=!0;continue}break;case"Boat Hull":case"Amphibious":case"Cable Car":case"Sky-Line":case"Dorandisch Earthline":break;default:console.error("Unknonw Locomotion in MachineryDisp")}t.disabled=!1}}UpdateDisplay(){this.locomotion.selectedIndex=this.vehicle.GetPropulsionIdx(),this.vehicle.CanPropeller()?this.prop_span.hidden=!1:this.prop_span.hidden=!0,this.vehicle.CanTurretHull()?this.turret_span.hidden=!1:this.turret_span.hidden=!0,this.pp_type.selectedIndex=this.vehicle.GetPowerplantIdx(),this.update_type&&this.SetSizeSel(),this.pp_size.selectedIndex=this.vehicle.GetPowerplantSizeIdx(),this.enlarged_engine.valueAsNumber=this.vehicle.GetEnlargedEngine(),this.extra_fuel.disabled=!this.vehicle.CanExtraFuel(),this.extra_fuel.valueAsNumber=this.vehicle.GetExtraFuel(),this.front_armour.valueAsNumber=this.vehicle.GetArmourFront(),this.side_armour.valueAsNumber=this.vehicle.GetArmourSide(),this.rear_armour.valueAsNumber=this.vehicle.GetArmourRear();let e=this.vehicle.GetCargo();this.s_cargo.valueAsNumber=e[1],this.m_cargo.valueAsNumber=e[2],this.l_cargo.valueAsNumber=e[3],this.h_cargo.valueAsNumber=e[4],this.UpdateLocomotion()}}class D{constructor(e){this.crewline=[],this.vehicle=e,this.crewdiv=document.getElementById("div_crew"),this.datalist=document.createElement("DATALIST");for(let e of I){let t=document.createElement("OPTION");t.value=e.name,t.text=e.name,this.datalist.append(t)}this.datalist.id="Crew_DataList",this.crewdiv.append(this.datalist),this.lastline=document.createElement("SELECT");for(let e of I){let t=document.createElement("OPTION");t.value=e.name,t.text=e.name,this.lastline.append(t)}this.lastline.onchange=()=>{this.vehicle.SetCrew(this.vehicle.GetCrewList().length,new B(this.lastline.options[this.lastline.selectedIndex].text,!1,!1,!1,!1,!1,!1,!1,[],[]))}}UpdateDisplay(){this.lastline.remove();for(var e=this.vehicle.GetCrewList();e.length>this.crewline.length;){let e=this.crewline.length;this.crewline.push(this.CreateLine(e))}for(;this.crewline.length>e.length;){let e=this.crewline.pop();e.span.remove(),e.br.remove();for(let t of e.loader)t.span.remove(),t.br.remove()}for(let t=0;t<e.length;t++){let s=this.crewline[t],i=e[t];for(;i.loaders.length>s.loader.length;){let e=s.loader.length,i=this.CreateLoader(t,e);0==s.loader.length?(s.br.insertAdjacentElement("afterend",i.span),i.span.insertAdjacentElement("afterend",i.br)):(s.loader[s.loader.length-1].br.insertAdjacentElement("afterend",i.span),i.span.insertAdjacentElement("afterend",i.br)),s.loader.push(i)}for(;s.loader.length>i.loaders.length;){let e=s.loader.pop();e.span.remove(),e.br.remove()}if(s.name_span.hidden=!1,s.name.value=i.name_txt,s.enclosed.checked=i.enclosed,i.enclosed&&this.vehicle.SumArmour()>0?(s.coup_span.hidden=!1,s.coupla.checked=i.coupla):s.coup_span.hidden=!0,i.enclosed?(s.seal_span.hidden=!1,s.seal.checked=i.sealed):s.seal_span.hidden=!0,s.loop_front.checked=i.loop_front,s.loop_left.checked=i.loop_left,s.loop_right.checked=i.loop_right,s.loop_back.checked=i.loop_back,s.num_mounts.valueAsNumber=i.weapon_mounts.length,0==i.GetNumLoaders()?s.has_loader.disabled=!0:s.has_loader.disabled=!1,0!=i.weapon_mounts.length){s.load_span.hidden=!1,s.has_loader.valueAsNumber=i.loaders.length;for(let e=0;e<i.loaders.length;e++)s.loader[e].span.hidden=!1,s.loader[e].br.hidden=!1,s.loader[e].enclosed.checked=i.loaders[e].enclosed,i.loaders[e].enclosed?(s.loader[e].coup_span.hidden=!1,s.loader[e].seal_span.hidden=!1,s.loader[e].coupla.checked=i.loaders[e].coupla,s.loader[e].seal.checked=i.loaders[e].sealed,s.loader[e].loop_front.checked=i.loaders[e].loop_front,s.loader[e].loop_left.checked=i.loaders[e].loop_left,s.loader[e].loop_right.checked=i.loaders[e].loop_right,s.loader[e].loop_back.checked=i.loaders[e].loop_back):(s.loader[e].coup_span.hidden=!0,s.loader[e].seal_span.hidden=!0)}else s.load_span.hidden=!0}this.crewdiv.append(this.lastline),this.lastline.selectedIndex=0}CreateLoader(e,t){let s={span:document.createElement("SPAN"),enc_span:void 0,enclosed:document.createElement("INPUT"),coup_span:void 0,coupla:document.createElement("INPUT"),seal_span:void 0,seal:document.createElement("INPUT"),loop_front:document.createElement("INPUT"),loop_left:document.createElement("INPUT"),loop_right:document.createElement("INPUT"),loop_back:document.createElement("INPUT"),br:document.createElement("BR")};s.enc_span=g("  Enclosed:",s.enclosed),s.coup_span=g("  Coupla/Hatch:",s.coupla),s.seal_span=g(" Sealed:",s.seal);let i=document.createElement("LABEL");i.innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;Loader&nbsp;";let o=g("  Loopholes F/L/R/B:",s.loop_front);o.append(s.loop_left),o.append(s.loop_right),o.append(s.loop_back),s.span.append(i),s.span.append(s.enc_span),s.span.append(s.coup_span),s.span.append(s.seal_span),s.span.append(o),s.enclosed.type="checkbox",s.coupla.type="checkbox",s.seal.type="checkbox",s.loop_front.type="checkbox",s.loop_left.type="checkbox",s.loop_right.type="checkbox",s.loop_back.type="checkbox";let r=()=>{this.vehicle.SetLoader(e,t,new L(s.enclosed.checked,s.coupla.checked,s.seal.checked,s.loop_front.checked,s.loop_left.checked,s.loop_right.checked,s.loop_back.checked))};return s.enclosed.onchange=r,s.coupla.onchange=r,s.seal.onchange=r,s.loop_front.onchange=r,s.loop_left.onchange=r,s.loop_right.onchange=r,s.loop_back.onchange=r,s}CreateLine(e){let t={span:document.createElement("SPAN"),name_span:void 0,rem:document.createElement("BUTTON"),add:document.createElement("BUTTON"),name:document.createElement("INPUT"),enc_span:void 0,enclosed:document.createElement("INPUT"),coup_span:void 0,coupla:document.createElement("INPUT"),seal_span:void 0,seal:document.createElement("INPUT"),loop_front:document.createElement("INPUT"),loop_left:document.createElement("INPUT"),loop_right:document.createElement("INPUT"),loop_back:document.createElement("INPUT"),num_mounts:document.createElement("INPUT"),load_span:void 0,has_loader:document.createElement("INPUT"),br:document.createElement("BR"),loader:[]};t.name_span=g("  Name:",t.name),t.name.setAttribute("list",this.datalist.id),t.rem.textContent="-",t.rem.onclick=()=>{this.vehicle.DeleteCrew(e)},t.add.textContent="+",t.add.onclick=()=>{this.vehicle.DuplicateCrew(e)},0==e&&(t.rem.disabled=!0,t.add.disabled=!0),t.name_span.insertAdjacentElement("afterbegin",t.add),t.name_span.insertAdjacentElement("afterbegin",t.rem),t.enc_span=g("  Enclosed:",t.enclosed),t.coup_span=g("  Coupla/Hatch:",t.coupla),t.seal_span=g("  Sealed:",t.seal);let s=g("  Number Weapons Mounts:",t.num_mounts);t.load_span=g("  Loader:",t.has_loader);let i=g("  Loopholes F/L/R/B:",t.loop_front);i.append(t.loop_left),i.append(t.loop_right),i.append(t.loop_back),t.span.append(t.name_span),t.span.append(t.enc_span),t.span.append(t.coup_span),t.span.append(t.seal_span),t.span.append(i),t.span.append(s),t.span.append(t.load_span),t.name.type="text",t.enclosed.type="checkbox",t.coupla.type="checkbox",t.seal.type="checkbox",t.loop_front.type="checkbox",t.loop_left.type="checkbox",t.loop_right.type="checkbox",t.loop_back.type="checkbox",t.num_mounts.type="number",t.num_mounts.min="0",t.num_mounts.step="1",t.has_loader.type="number",t.has_loader.step="1",t.has_loader.min="0";let o=()=>{this.vehicle.SetCrew(e,new B(t.name.value,t.enclosed.checked,t.coupla.checked,t.seal.checked,t.loop_front.checked,t.loop_left.checked,t.loop_right.checked,t.loop_back.checked,void 0,void 0))};return t.name.onchange=o,t.enclosed.onchange=o,t.coupla.onchange=o,t.seal.onchange=o,t.loop_front.onchange=o,t.loop_left.onchange=o,t.loop_right.onchange=o,t.loop_back.onchange=o,t.num_mounts.onchange=()=>{this.vehicle.SetNumWeapons(e,t.num_mounts.valueAsNumber)},t.has_loader.onchange=()=>{this.vehicle.SetNumLoaders(e,t.has_loader.valueAsNumber)},this.crewdiv.append(t.span),this.crewdiv.append(t.br),t}}class F{constructor(e){this.vehicle=e,this.tbl=document.getElementById("table_weapons");var t=this.tbl.insertRow();n(t,"Crew Position"),n(t,"Main Weapon"),n(t,"Firing Arcs"),n(t,"Co-Ax Weapons"),n(t,"Accessories"),this.wrows=[]}UpdateDisplay(){let e=P(),t=this.vehicle.GetCrewList(),s=this.vehicle.GetNumWeapons(),i=0;for(;this.wrows.length>s;)this.wrows.pop(),this.tbl.deleteRow(this.tbl.rows.length-1);for(let s=0;s<t.length;s++){let o=t[s],r=0;for(let t of o.weapon_mounts){r+=1,i>=this.wrows.length&&this.CreateRow(this.wrows.length);let s=this.wrows[i];this.SetOpts(s.main,e);for(let t of s.secondary)this.SetOpts(t,e);for(s.crew.textContent=o.name_txt+" Mount "+r.toString(),s.main.selectedIndex=t.main_idx,s.rocket_span.hidden="Rocket Artillery Rail"!=e[t.main_idx].name,s.rocket_count.valueAsNumber=t.rocket_count,s.f.checked=t.directions[0],s.r.checked=t.directions[1],s.b.checked=t.directions[2],s.l.checked=t.directions[3],s.u.checked=t.directions[4];s.secondary.length>t.secondary_idx.length+1;)s.sec_cell.removeChild(this.wrows[i].secondary.pop()),s.sec_cell.removeChild(s.sec_cell.children[s.sec_cell.children.length-1]);for(let e=0;e<t.secondary_idx.length;e++){if(e==s.secondary.length){let e=this.CreateSecondary();e.onchange=s.f.onchange,s.sec_cell.append(e),s.sec_cell.append(document.createElement("BR")),s.secondary.push(e)}s.secondary[e].selectedIndex=t.secondary_idx[e]}if(s.secondary.length==t.secondary_idx.length){let e=this.CreateSecondary();e.onchange=s.f.onchange,s.sec_cell.append(e),s.sec_cell.append(document.createElement("BR")),s.secondary.push(e)}s.secondary[t.secondary_idx.length].selectedIndex=0,s.shield.checked=t.shield,s.gunsight.selectedIndex=t.gunsight,0==t.main_idx?(s.secondary[0].disabled=!0,s.f.disabled=!0,s.l.disabled=!0,s.r.disabled=!0,s.b.disabled=!0,s.u.disabled=!0,s.shield.disabled=!0,s.gunsight.disabled=!0):(s.secondary[0].disabled=!1,s.f.disabled=!1,s.l.disabled=!1,s.r.disabled=!1,s.b.disabled=!1,s.u.disabled=!1,s.shield.disabled=!1,s.gunsight.disabled=!1),i+=1}}}SetOpts(e,t){for(let s=0;s<t.length;s++)if(s<e.options.length)e.options[s].text=t[s].name,e.options[s].value=t[s].name;else{let i=document.createElement("OPTION");i.text=t[s].name,i.value=t[s].name,e.options.add(i)}for(;e.options.length>t.length;)e.options.remove(e.options.length-1)}CreateSecondary(){let e=document.createElement("SELECT");for(let t of P()){let s=document.createElement("OPTION");s.value=t.name,s.text=t.name,"Rocket Artillery Rail"==t.name&&(s.disabled=!0),e.append(s)}return e.selectedIndex=0,e}CreateRow(e){let t={row:this.tbl.insertRow(),crew:document.createElement("LABEL"),main:document.createElement("SELECT"),rocket_span:document.createElement("SPAN"),rocket_count:document.createElement("INPUT"),f:document.createElement("INPUT"),r:document.createElement("INPUT"),b:document.createElement("INPUT"),l:document.createElement("INPUT"),u:document.createElement("INPUT"),sec_cell:void 0,secondary:[],shield:document.createElement("INPUT"),gunsight:document.createElement("SELECT")},s=()=>{this.vehicle.SetWeapon(e,new T(t.main.selectedIndex,[t.f.checked,t.r.checked,t.b.checked,t.l.checked,t.u.checked],t.secondary.map((e=>e.selectedIndex)),t.shield.checked,t.gunsight.selectedIndex,t.rocket_count.valueAsNumber))};t.row.insertCell().append(t.crew);let i=t.row.insertCell();i.append(t.main),i.append(document.createElement("BR")),i.append(t.rocket_span);for(let e of P()){let s=document.createElement("OPTION");s.value=e.name,s.text=e.name,t.main.append(s)}for(let e of G){let s=document.createElement("OPTION");s.value=e,s.text=e,t.gunsight.append(s)}let r=t.row.insertCell();c("Forward",t.f,r,!0),c("Left",t.l,r,!1),c("Right",t.r,r,!0),c("Backward",t.b,r,!0),c("Upward",t.u,r,!1),a("Rocket Count: ",t.rocket_count,t.rocket_span),t.rocket_count.min="1",t.rocket_count.step="1",t.main.onchange=s,t.rocket_count.onchange=s,t.f.onchange=s,t.r.onchange=s,t.b.onchange=s,t.l.onchange=s,t.u.onchange=s,t.sec_cell=t.row.insertCell();let n=t.row.insertCell();c("Gun Shield",t.shield,n,!0),function(e,t,s,i=!0){const r=document.createElement("SPAN"),n=document.createElement("LABEL");t.id=o(),n.htmlFor=t.id,n.style.marginLeft="0.25em",n.style.marginRight="0.5em",n.textContent=e,r.appendChild(n),r.appendChild(t),s.appendChild(r),i&&s.appendChild(document.createElement("BR"))}("Gunsight: ",t.gunsight,n),t.shield.onchange=s,t.gunsight.onchange=s,this.wrows.push(t)}}class z{constructor(e){this.vehicle=e,this.accessories=e.GetAccessories();let t=r(document.getElementById("div_accessories")),s=r(t.div1),i=r(t.div2);this.extra_armour=document.createElement("INPUT"),this.extra_armour.onchange=()=>{this.accessories.extra_armour=this.extra_armour.checked,this.vehicle.CalculateStats()},this.wooden_armour=document.createElement("INPUT"),this.wooden_armour.onchange=()=>{this.accessories.wooden_armour=this.wooden_armour.checked,this.vehicle.CalculateStats()},this.cruise_control=document.createElement("INPUT"),this.cruise_control.onchange=()=>{this.accessories.cruise_control=this.cruise_control.checked,this.vehicle.CalculateStats()},this.intercom=document.createElement("INPUT"),this.intercom.onchange=()=>{this.accessories.intercom=this.intercom.checked,this.vehicle.CalculateStats()},this.wireless=document.createElement("INPUT"),this.wireless.onchange=()=>{this.accessories.wireless=this.wireless.checked,this.vehicle.CalculateStats()},this.temp_control=document.createElement("INPUT"),this.temp_control.onchange=()=>{this.accessories.temp_control=this.temp_control.checked,this.vehicle.CalculateStats()},this.gas_filters=document.createElement("INPUT"),this.gas_filters.onchange=()=>{this.accessories.gas_filters=this.gas_filters.checked,this.vehicle.CalculateStats()},this.dozer_blades=document.createElement("INPUT"),this.dozer_blades.onchange=()=>{this.accessories.dozer_blades=this.dozer_blades.checked,this.vehicle.CalculateStats()},this.wire_cutters=document.createElement("INPUT"),this.wire_cutters.onchange=()=>{this.accessories.wire_cutters=this.wire_cutters.checked,this.vehicle.CalculateStats()},this.clockwerk_missile=document.createElement("INPUT"),this.clockwerk_missile.onchange=()=>{this.accessories.clockwerk_missile=this.clockwerk_missile.checked,this.vehicle.CalculateStats()},this.smokescreen=document.createElement("INPUT"),this.smokescreen.onchange=()=>{this.accessories.smokescreen=this.smokescreen.checked,this.vehicle.CalculateStats()},this.camouflage=document.createElement("INPUT"),this.camouflage.onchange=()=>{this.accessories.camouflage=this.camouflage.checked,this.vehicle.CalculateStats()},this.steering_trailer=document.createElement("INPUT"),this.steering_trailer.onchange=()=>{this.accessories.steering_trailer=this.steering_trailer.checked,this.vehicle.CalculateStats()},u("Extra Armour",this.extra_armour,s),u("Wooden Spaced Armour",this.wooden_armour,i),u("Cruise Control",this.cruise_control,s),u("Temperature Control",this.temp_control,i),u("Intercom",this.intercom,s),u("Wireless",this.wireless,i),u("Gas Filters",this.gas_filters,s),u("Dozer Blades",this.dozer_blades,i),u("Wire Cutters",this.wire_cutters,s),u("Steering Trailer",this.steering_trailer,i),u("Smokescreen",this.smokescreen,s),u("Camouflage",this.camouflage,i),u("Clockwerk Missile Rail",this.clockwerk_missile,s),d(i)}UpdateDisplay(){this.extra_armour.checked=this.accessories.extra_armour,this.wooden_armour.checked=this.accessories.wooden_armour,this.cruise_control.checked=this.accessories.cruise_control,this.intercom.checked=this.accessories.intercom,this.wireless.checked=this.accessories.wireless,this.temp_control.checked=this.accessories.temp_control,this.gas_filters.checked=this.accessories.gas_filters,this.dozer_blades.checked=this.accessories.dozer_blades,this.wire_cutters.checked=this.accessories.wire_cutters,this.clockwerk_missile.checked=this.accessories.clockwerk_missile,this.smokescreen.checked=this.accessories.smokescreen,this.camouflage.checked=this.accessories.camouflage,this.steering_trailer.checked=this.accessories.steering_trailer,this.accessories.is_enclosed?(this.gas_filters.disabled=!1,this.temp_control.disabled=!1):(this.gas_filters.disabled=!0,this.temp_control.disabled=!0)}}class q{constructor(e){this.weap_lines=[],this.part_lines=[],this.vehicle=e,this.custom=e.GetCustom(),this.div=document.getElementById("div_alter");let t=r(this.div),s=r(t.div1),i=r(t.div2);this.count_weap=document.createElement("INPUT"),this.count_part=document.createElement("INPUT"),this.br=document.createElement("BR"),this.div.append(this.br),l("Number of Weapons: ",this.count_weap,s),l("Number of Parts: ",this.count_part,i),this.count_part.onchange=()=>{for(;this.custom.GetParts().length>this.count_part.valueAsNumber;)this.custom.RemovePart();for(;this.custom.GetParts().length<this.count_part.valueAsNumber;)this.custom.AddPart();this.vehicle.CalculateStats()},this.count_weap.onchange=()=>{for(;this.custom.GetWeapons().length>this.count_weap.valueAsNumber;)this.custom.RemoveWeapon();for(;this.custom.GetWeapons().length<this.count_weap.valueAsNumber;)this.custom.AddWeapon();this.vehicle.CalculateStats()}}UpdateDisplay(){let e=this.custom.GetParts();for(;this.part_lines.length>e.length;)this.part_lines.pop().span.div0.remove();for(;this.part_lines.length<e.length;)this.part_lines.push(this.CreatePartLine(this.part_lines.length));for(let t=0;t<e.length;t++)this.UpdatePartLine(this.part_lines[t],e[t]);let t=this.custom.GetWeapons();for(;this.weap_lines.length>t.length;)this.weap_lines.pop().span.remove();for(;this.weap_lines.length<t.length;)this.weap_lines.push(this.CreateWeaponLine(this.weap_lines.length));for(let e=0;e<t.length;e++)this.UpdateWeaponLine(this.weap_lines[e],t[e]);this.count_part.valueAsNumber=this.part_lines.length,this.count_weap.valueAsNumber=this.weap_lines.length}CreatePartLine(e){let s={span:r(),cost:document.createElement("INPUT"),upkeep:document.createElement("INPUT"),speed:document.createElement("INPUT"),torque:document.createElement("INPUT"),handling:document.createElement("INPUT"),integrity:document.createElement("INPUT"),safety:document.createElement("INPUT"),reliability:document.createElement("INPUT"),fuel:document.createElement("INPUT"),stress:document.createElement("INPUT"),volume:document.createElement("INPUT"),name:document.createElement("INPUT"),warning:document.createElement("INPUT")},i=r(s.span.div1),o=r(s.span.div2);h("Name:",s.name,i),h("Special Rules:",s.warning,o);let n=r(i.div1),a=r(i.div2),c=r(o.div1),u=r(o.div2);l("Cost:",s.cost,n),l("Upkeep:",s.upkeep,a),l("Speed:",s.speed,c),l("Torque:",s.torque,u),l("Handling:",s.handling,n),l("Integrity:",s.integrity,a),l("Safety:",s.safety,c),l("Reliability:",s.reliability,u),l("Fuel:",s.fuel,n),l("Stress:",s.stress,a),l("Volume:",s.volume,c),d(u),s.cost.min="",s.upkeep.min="",s.speed.min="",s.torque.min="",s.handling.min="",s.integrity.min="",s.safety.min="",s.reliability.min="",s.fuel.min="",s.stress.min="",s.volume.min="";let m=()=>{this.custom.SetPart(e,s.name.value,new b({cost:s.cost.valueAsNumber,upkeep:s.upkeep.valueAsNumber,speed:s.speed.valueAsNumber,torque:s.torque.valueAsNumber,handling:s.handling.valueAsNumber,integrity:s.integrity.valueAsNumber,safety:s.safety.valueAsNumber,reliability:s.reliability.valueAsNumber,fuel:s.fuel.valueAsNumber,stress:s.stress.valueAsNumber,volume:s.volume.valueAsNumber,warnings:[{source:s.name.value,warning:s.warning.value,color:t.YELLOW}]})),this.vehicle.CalculateStats()};return s.name.onchange=m,s.warning.onchange=m,s.cost.onchange=m,s.upkeep.onchange=m,s.speed.onchange=m,s.torque.onchange=m,s.handling.onchange=m,s.integrity.onchange=m,s.safety.onchange=m,s.reliability.onchange=m,s.fuel.onchange=m,s.stress.onchange=m,s.volume.onchange=m,this.br.insertAdjacentElement("beforebegin",s.span.div0),s}UpdatePartLine(e,t){e.name.value=t.name,e.warning.value=t.stats.warnings[0].warning,e.cost.valueAsNumber=t.stats.cost,e.upkeep.valueAsNumber=t.stats.upkeep,e.speed.valueAsNumber=t.stats.speed,e.torque.valueAsNumber=t.stats.torque,e.handling.valueAsNumber=t.stats.handling,e.integrity.valueAsNumber=t.stats.integrity,e.safety.valueAsNumber=t.stats.safety,e.reliability.valueAsNumber=t.stats.reliability,e.fuel.valueAsNumber=t.stats.fuel,e.stress.valueAsNumber=t.stats.stress,e.volume.valueAsNumber=t.stats.volume}CreateWeaponLine(e){let t={span:document.createElement("SPAN"),name:document.createElement("INPUT"),cost:document.createElement("INPUT"),loader:document.createElement("INPUT"),heavy:document.createElement("INPUT"),artillery:document.createElement("INPUT")};!function(e,t,s,i=!0){const r=document.createElement("SPAN"),n=document.createElement("LABEL");t.id=o(),n.htmlFor=t.id,n.style.marginLeft="0.25em",n.style.marginRight="0.5em",n.textContent=e,t.setAttribute("type","text"),t.value="Default",r.appendChild(n),r.appendChild(t),s.appendChild(r),i&&s.appendChild(document.createElement("BR"))}("Name:",t.name,t.span,!1),a("Cost:",t.cost,t.span,!1),c("Loader:",t.loader,t.span,!1),c("Artillery:",t.artillery,t.span,!1),a("Heavy:",t.heavy,t.span,!0);let s=()=>{this.custom.SetWeapon(e,t.name.value,t.cost.valueAsNumber,t.loader.checked,t.heavy.valueAsNumber,t.artillery.checked),this.vehicle.CalculateStats()};return t.name.onchange=s,t.cost.onchange=s,t.loader.onchange=s,t.artillery.onchange=s,t.heavy.onchange=s,this.div.append(t.span),t}UpdateWeaponLine(e,t){e.name.value=t.name,e.cost.valueAsNumber=t.cost,e.loader.checked=t.loader,e.artillery.checked=t.artillery,e.heavy.valueAsNumber=t.heavy,e.loader.disabled=t.artillery,e.heavy.disabled=!t.artillery}}class O{constructor(){this.dash_canvas=document.createElement("CANVAS"),this.dash_canvas.width=1754,this.dash_canvas.height=1240,this.dash_image=document.getElementById("dash_img"),this.dash_image.width=1754,this.dash_image.height=1240}SaveDash(e){var t=this.dash_canvas.getContext("2d");let s=e.CalculateStats();t.clearRect(0,0,this.dash_canvas.width,this.dash_canvas.height),t.textAlign="center",t.drawImage(this.dash_image,0,0),t.font="70px Balthazar",t.fillText(s.fuel.toString(),486,550,100),t.fillText(s.handling.toString(),655,220,100),s.walker_torque?t.fillText(w.Format("+{0}/{1}",s.walker_torque,s.torque),850,220,100):t.fillText(s.torque.toString(),850,220,100),t.fillText(s.stress.toString(),655,390,100),t.fillText(s.integrity.toString(),850,390,100),t.fillText(s.reliability.toString(),305,855,100),t.fillText(e.GetArmourFront().toString(),1080,185,100),t.fillText(e.GetArmourSide().toString(),990,290,100),t.fillText(e.GetArmourSide().toString(),1170,245,100),t.fillText(e.GetArmourRear().toString(),1080,365,100),t.fillText(e.GetArmourRear().toString(),1170,335,100),t.fillText(s.safety.toString(),1570,1065,100),t.font="35px Balthazar",t.textAlign="center";let i=0;for(let s of e.GetCrewList())if(i<8){t.textAlign="left",t.fillText(s.name_txt,590,600+55*i,212),t.textAlign="center",s.enclosed?s.sealed?t.fillText("Sealed",845,600+55*i,100):t.fillText("Closed",845,600+55*i,100):t.fillText("Exposed",845,600+55*i,100),t.fillText((s.GetVisibility()??"-").toString(),935,600+55*i,100),t.fillText((s.GetEscape()??"-").toString(),1015,600+55*i,100);let e=[];s.enclosed&&s.coupla&&e.push("Hatch"),""!=s.WeaponString()&&e.push(s.WeaponString()),t.textAlign="left",t.fillText(w.Join(", ",e),1065,600+55*i,575),t.textAlign="center",i++;for(let e=0;e<s.loaders.length;e++){let o=s.loaders[e];t.textAlign="left",t.fillText("Loader",590,600+55*i,212),t.textAlign="center",o.enclosed?o.sealed?t.fillText("Sealed",845,600+55*i,100):t.fillText("Closed",845,600+55*i,100):t.fillText("Exposed",845,600+55*i,100),t.fillText((s.GetVisibility(e)??"-").toString(),935,600+55*i,100),t.fillText((s.GetEscape(e)??"-").toString(),1015,600+55*i,100);let r=[];o.enclosed&&o.coupla&&r.push("Hatch"),t.textAlign="left",t.fillText(w.Join(", ",r),1065,600+55*i,575),t.textAlign="center",i++}}this.download("Test Name_Dashboard",this.dash_canvas)}download(e,t){var s=document.createElement("a");s.download=e+".png",s.href=t.toDataURL("image/png"),s.click()}}class V{constructor(e){this.vehicle=e,e.SetDisplayCallback((e=>{this.UpdateDisplay(e)})),this.stats=new U(e),this.armour=new M(e),this.crew=new D(e),this.weps=new F(e),this.accessories=new z(e),this.custom=new q(e),document.getElementById("acft_save_link").onclick=()=>{this.SaveLink()},this.cards=new O,document.getElementById("acft_save_dash").onclick=()=>{this.cards.SaveDash(this.vehicle)},document.getElementById("acft_reset").onclick=()=>{this.vehicle.Reset(),this.vehicle.CalculateStats()},document.getElementById("acft_save_cat")}UpdateDisplay(e){let t=document.getElementById("lbl_mech").getBoundingClientRect().top;this.stats.UpdateDisplay(e),this.armour.UpdateDisplay(),this.crew.UpdateDisplay(),this.weps.UpdateDisplay(),this.accessories.UpdateDisplay(),this.custom.UpdateDisplay();let s=document.getElementById("lbl_mech").getBoundingClientRect().top;window.scrollBy(0,s-t)}MakeLink(){const e=new f;this.vehicle.Serialize(e);const t=m(e.FinalArray()),i=s.compressToEncodedURIComponent(t);return location.protocol+"//"+location.host+location.pathname+"?tank="+i}SaveLink(){navigator.clipboard.writeText(this.MakeLink())}}function j(){J(),Z().hash&&(ue.forEach(Y),ne?.observe(document,he),X(),ae=setTimeout(J,ce))}function J(){clearTimeout(ae),cancelAnimationFrame(le),ne?.disconnect(),ue.forEach($)}function Y(e){document.addEventListener(e,J)}function $(e){document.removeEventListener(e,J)}function Q(e){if(e.defaultPrevented)return;const t=function(e){let t=e;for(;t&&"A"!==t.nodeName;)t=t.parentElement;return t}(e.target);t&&t.hash&&t.pathname===Z().pathname&&se(j)}function K(){se(X)}function X(){const e=Z().hash;if(!e)return;const t=decodeURIComponent(e.substring(1)),s=ie.call(null,t);s&&oe.call(null,s)}function Z(){return location}function ee(e){return document.getElementById(e)}function te(e){e.scrollIntoView()}function se(e){cancelAnimationFrame(le),le=requestAnimationFrame(e)}let ie,oe,re,ne,ae,le;const he={attributes:!0,characterData:!0,childList:!0,subtree:!0},ce=1e4,ue=["selectstart","touchend","wheel"];window.addEventListener("DOMContentLoaded",(()=>{const e=new URLSearchParams(location.search);var t=e.get("tank");e.get("test"),de=new R;let i=window.localStorage.getItem("tank");var o=!1;if(t&&!o){console.log("Used Query Parameter");try{var r=p(s.decompressFromEncodedURIComponent(t)),n=new _(r);console.log(n.version),de.Deserialize(n),o=!0}catch(e){console.log("Compressed Query Parameter Failed."),console.log(e),de.Reset()}}if(i&&!o){console.log("Used Saved Data");try{r=p(s.decompressFromEncodedURIComponent(i)),n=new _(r),console.log(n.version),de.Deserialize(n),o=!0}catch(e){console.log("Compressed Query Parameter Failed."),console.log(e),de.Reset()}}new V(de),de.CalculateStats(),window.addEventListener("load",(()=>{(function(e={}){J(),removeEventListener("click",Q),re&&re(),re=void 0,ne=void 0,ie=e.getElement||ee,oe=e.scrollIntoView||te,ne=new MutationObserver(K),addEventListener("click",Q),re=void 0,j()})(),setTimeout((()=>{window.onscroll=function(e,t){let s;return function(){clearTimeout(s),s=setTimeout(e,250)}}(pe)}),1e3)}));var a=document.getElementsByClassName("collapsible");for(let e=0;e<a.length;e++)a[e].addEventListener("click",(function(){var e=this.classList.toggle("active"),t=this.nextElementSibling;(t=t.nextElementSibling).style.maxHeight=e?"inherit":"0px"}))}));var de,me="";function pe(e){const t=["Fight","Machinery","Crew","Weapons","Accessories","Stats"];var s="",i=window.pageYOffset;for(let e of t)if(0!=document.getElementById(e).offsetTop){if(!(i>document.getElementById(e).offsetTop))break;s=e}me!=s&&(me=s,window.history.replaceState(null,null,"index.html#"+s))}})();